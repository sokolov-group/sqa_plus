K_aacc  = einsum('WZXY->XYWZ', v_aaaa, optimize = einsum_type).copy()
K_aacc += einsum('WX,YZ->XYWZ', h_aa, np.identity(ncas), optimize = einsum_type)
K_aacc += einsum('YZ,WX->XYWZ', h_aa, np.identity(ncas), optimize = einsum_type)
K_aacc -= 1/2 * einsum('WX,ZY->XYWZ', h_aa, rdm_ca, optimize = einsum_type)
K_aacc += 1/6 * einsum('Wx,XYZx->XYWZ', h_aa, rdm_ccaa, optimize = einsum_type)
K_aacc += 1/3 * einsum('Wx,XYxZ->XYWZ', h_aa, rdm_ccaa, optimize = einsum_type)
K_aacc -= 1/2 * einsum('YZ,WX->XYWZ', h_aa, rdm_ca, optimize = einsum_type)
K_aacc += 1/3 * einsum('Zx,WxXY->XYWZ', h_aa, rdm_ccaa, optimize = einsum_type)
K_aacc += 1/6 * einsum('Zx,WxYX->XYWZ', h_aa, rdm_ccaa, optimize = einsum_type)
K_aacc -= 1/2 * einsum('WZXx,xY->XYWZ', v_aaaa, rdm_ca, optimize = einsum_type)
K_aacc -= 1/2 * einsum('WZxY,xX->XYWZ', v_aaaa, rdm_ca, optimize = einsum_type)
K_aacc += 1/3 * einsum('WZxy,XYxy->XYWZ', v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc += 1/6 * einsum('WZxy,XYyx->XYWZ', v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc -= 1/2 * einsum('WxXY,Zx->XYWZ', v_aaaa, rdm_ca, optimize = einsum_type)
K_aacc -= 1/2 * einsum('WxXy,YxZy->XYWZ', v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc += 1/3 * einsum('WxyX,YxZy->XYWZ', v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc += 1/6 * einsum('WxyX,YxyZ->XYWZ', v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc += 1/6 * einsum('WxyY,XxZy->XYWZ', v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc += 1/3 * einsum('WxyY,XxyZ->XYWZ', v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc += 1/12 * einsum('Wxyz,ZyzXYx->XYWZ', v_aaaa, rdm_cccaaa, optimize = einsum_type)
K_aacc -= 1/12 * einsum('Wxyz,ZyzXxY->XYWZ', v_aaaa, rdm_cccaaa, optimize = einsum_type)
K_aacc += 1/4 * einsum('Wxyz,ZyzYXx->XYWZ', v_aaaa, rdm_cccaaa, optimize = einsum_type)
K_aacc -= 1/12 * einsum('Wxyz,ZyzYxX->XYWZ', v_aaaa, rdm_cccaaa, optimize = einsum_type)
K_aacc -= 1/12 * einsum('Wxyz,ZyzxXY->XYWZ', v_aaaa, rdm_cccaaa, optimize = einsum_type)
K_aacc -= 1/12 * einsum('Wxyz,ZyzxYX->XYWZ', v_aaaa, rdm_cccaaa, optimize = einsum_type)
K_aacc -= 1/2 * einsum('XYxZ,Wx->XYWZ', v_aaaa, rdm_ca, optimize = einsum_type)
K_aacc += 1/6 * einsum('XxyZ,WxYy->XYWZ', v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc += 1/3 * einsum('XxyZ,WxyY->XYWZ', v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc -= 1/2 * einsum('YxZy,WxXy->XYWZ', v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc += 1/3 * einsum('YxyZ,WxXy->XYWZ', v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc += 1/6 * einsum('YxyZ,WxyX->XYWZ', v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc += 1/4 * einsum('Zxyz,WyzXYx->XYWZ', v_aaaa, rdm_cccaaa, optimize = einsum_type)
K_aacc -= 1/12 * einsum('Zxyz,WyzXxY->XYWZ', v_aaaa, rdm_cccaaa, optimize = einsum_type)
K_aacc += 1/12 * einsum('Zxyz,WyzYXx->XYWZ', v_aaaa, rdm_cccaaa, optimize = einsum_type)
K_aacc -= 1/12 * einsum('Zxyz,WyzYxX->XYWZ', v_aaaa, rdm_cccaaa, optimize = einsum_type)
K_aacc -= 1/12 * einsum('Zxyz,WyzxXY->XYWZ', v_aaaa, rdm_cccaaa, optimize = einsum_type)
K_aacc -= 1/12 * einsum('Zxyz,WyzxYX->XYWZ', v_aaaa, rdm_cccaaa, optimize = einsum_type)
K_aacc -= 1/2 * einsum('Wx,YZ,xX->XYWZ', h_aa, np.identity(ncas), rdm_ca, optimize = einsum_type)
K_aacc -= 1/2 * einsum('Zx,WX,xY->XYWZ', h_aa, np.identity(ncas), rdm_ca, optimize = einsum_type)
K_aacc += einsum('WX,YxZy,xy->XYWZ', np.identity(ncas), v_aaaa, rdm_ca, optimize = einsum_type)
K_aacc -= 1/2 * einsum('WX,YxyZ,xy->XYWZ', np.identity(ncas), v_aaaa, rdm_ca, optimize = einsum_type)
K_aacc -= 1/2 * einsum('WX,Zxyz,Yxyz->XYWZ', np.identity(ncas), v_aaaa, rdm_ccaa, optimize = einsum_type)
K_aacc += einsum('YZ,WxXy,yx->XYWZ', np.identity(ncas), v_aaaa, rdm_ca, optimize = einsum_type)
K_aacc -= 1/2 * einsum('YZ,WxyX,yx->XYWZ', np.identity(ncas), v_aaaa, rdm_ca, optimize = einsum_type)
K_aacc -= 1/2 * einsum('YZ,Wxyz,Xxyz->XYWZ', np.identity(ncas), v_aaaa, rdm_ccaa, optimize = einsum_type)
