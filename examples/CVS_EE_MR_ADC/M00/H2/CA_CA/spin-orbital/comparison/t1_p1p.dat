        temp  = einsum('Ix,JXYx->IXJY', h_ca_so[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += einsum('Jx,IYXx->IXJY', h_ca_so[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('IYxy,JXxy->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += einsum('Ix,JXYx->IXJY', t1_ca[:ncvs_so,:], v_caaa_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('JXxy,IYxy->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += einsum('Jx,IYXx->IXJY', t1_ca[:ncvs_so,:], v_caaa_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += einsum('iX,JiIY->IXJY', t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], optimize = einsum_type)
        temp += einsum('iY,IiJX->IXJY', t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], optimize = einsum_type)
        temp += einsum('iXYx,IiJx->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], optimize = einsum_type)
        temp += einsum('iYXx,JiIx->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], optimize = einsum_type)
        temp -= 0.5 * einsum('I,IYXx,Jx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp += 0.25 * einsum('I,IYxy,JXxy->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('I,Ix,JXYx->IXJY', e_core_so[:ncvs_so], t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('J,IYXx,Jx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp += 0.25 * einsum('J,IYxy,JXxy->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('J,Ix,JXYx->IXJY', e_core_so[:ncvs_so], t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= einsum('Ix,XY,Jx->IXJY', h_ca_so[:ncvs_so,:], np.identity(ncas_so), t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp -= einsum('Jx,XY,Ix->IXJY', h_ca_so[:ncvs_so,:], np.identity(ncas_so), t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp -= einsum('iX,IJ,iY->IXJY', h_ca_so, np.identity(ncvs_so), t1_ca, optimize = einsum_type)
        temp -= einsum('iY,IJ,iX->IXJY', h_ca_so, np.identity(ncvs_so), t1_ca, optimize = einsum_type)
        temp -= einsum('ix,IJ,iXYx->IXJY', h_ca_so, np.identity(ncvs_so), t1_caaa, optimize = einsum_type)
        temp -= einsum('ix,IJ,iYXx->IXJY', h_ca_so, np.identity(ncvs_so), t1_caaa, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,IYxy,Jy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,JxYy,Iy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp += 0.25 * einsum('Xx,Jxyz,IYyz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IxXy,Jy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp += 0.25 * einsum('Yx,Ixyz,JXyz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('Yx,JXxy,Iy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp += einsum('xy,IYXx,Jy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp -= einsum('xy,IYxz,JXyz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += einsum('xy,Ix,JXYy->IXJY', h_aa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= einsum('IJ,ix,iXYx->IXJY', np.identity(ncvs_so), t1_ca, v_caaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,iXxy,iYxy->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,iYxy,iXxy->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, optimize = einsum_type)
        temp -= einsum('IJ,ix,iYXx->IXJY', np.identity(ncvs_so), t1_ca, v_caaa_so, optimize = einsum_type)
        temp -= einsum('XY,ix,JiIx->IXJY', np.identity(ncas_so), t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], optimize = einsum_type)
        temp -= einsum('XY,ix,IiJx->IXJY', np.identity(ncas_so), t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], optimize = einsum_type)
        temp -= einsum('XxYy,Jx,Iy->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Jx,IYyz->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Ix,JXyz->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IYxy,JXzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('I,XY,Ix,Jx->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ca[:ncvs_so,:], t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp += 0.5 * einsum('J,XY,Ix,Jx->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ca[:ncvs_so,:], t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp += einsum('i,IJ,iX,iY->IXJY', e_core_so, np.identity(ncvs_so), t1_ca, t1_ca, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,iXYx,ix->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_ca, optimize = einsum_type)
        temp -= 0.25 * einsum('i,IJ,iXxy,iYxy->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,iYXx,ix->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_ca, optimize = einsum_type)
        temp -= 0.25 * einsum('i,IJ,iYxy,iXxy->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ix,iXYx->IXJY', e_core_so, np.identity(ncvs_so), t1_ca, t1_caaa, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ix,iYXx->IXJY', e_core_so, np.identity(ncvs_so), t1_ca, t1_caaa, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IJ,ix,iY->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_ca, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IJ,iYxy,iy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,IJ,ixYy,iy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, optimize = einsum_type)
        temp -= 0.25 * einsum('Xx,IJ,ixyz,iYyz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,ix,iX->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_ca, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,iXxy,iy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,ixXy,iy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, optimize = einsum_type)
        temp -= 0.25 * einsum('Yx,IJ,ixyz,iXyz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, optimize = einsum_type)
        temp -= einsum('xy,IJ,ix,iXYy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_caaa, optimize = einsum_type)
        temp -= einsum('xy,IJ,ix,iYXy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_caaa, optimize = einsum_type)
        temp += einsum('xy,IJ,iXxz,iYyz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, optimize = einsum_type)
        temp -= einsum('xy,XY,Ix,Jy->IXJY', h_aa_so, np.identity(ncas_so), t1_ca[:ncvs_so,:], t1_ca[:ncvs_so,:], optimize = einsum_type)
        temp += einsum('IJ,XxYy,ix,iy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_ca, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,ix,iYyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,ix,iXyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iXxy,iYzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, optimize = einsum_type)
        temp += einsum('Ix,JXxy,Yy->IXJY', h_ca_so[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Ix,Jx,YX->IXJY', h_ca_so[:ncvs_so,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Ix,JyYx,yX->IXJY', h_ca_so[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Jx,IYxy,yX->IXJY', h_ca_so[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Jx,Ix,YX->IXJY', h_ca_so[:ncvs_so,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Jx,IyXx,Yy->IXJY', h_ca_so[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('IYXx,Jzxy,zy->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IYxy,Jzxy,zX->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('IYxy,JXxz,yz->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Ix,JyYx,yX->IXJY', t1_ca[:ncvs_so,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Ix,JXxy,Yy->IXJY', t1_ca[:ncvs_so,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('IxXy,JzYy,zx->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IxXy,JxYz,yz->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Ixyz,JXYy,zx->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Ixyz,JXyz,Yx->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('JXYx,Iyxz,zy->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('JXxy,IYxz,zy->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('JXxy,Izxy,Yz->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Jx,IYxy,yX->IXJY', t1_ca[:ncvs_so,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Jx,IyXx,Yy->IXJY', t1_ca[:ncvs_so,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('JxYy,IxXz,zy->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('JxYy,IzXy,xz->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Jxyz,IYXy,xz->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Jxyz,IYyz,xX->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('iX,JiIx,Yx->IXJY', t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('iY,IiJx,xX->IXJY', t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('ix,JiIx,YX->IXJY', t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('iXYx,IiJy,yx->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('iXxy,IiJx,Yy->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('iYXx,JiIy,xy->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('iYxy,JiIx,yX->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('ix,JiIY,xX->IXJY', t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('ix,IiJX,Yx->IXJY', t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('ix,IiJx,YX->IXJY', t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('ixXy,JiIY,yx->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('ixXy,JiIy,Yx->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('ixYy,IiJX,xy->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('ixYy,IiJy,xX->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,IYXx,Jyxz,yz->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,IYxy,JXxz,yz->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,IYxy,Jx,yX->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('I,IYxy,Jzxy,zX->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,Ix,JXxy,Yy->IXJY', e_core_so[:ncvs_so], t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,Ix,Jx,YX->IXJY', e_core_so[:ncvs_so], t1_ca[:ncvs_so,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,Ix,JyYx,yX->IXJY', e_core_so[:ncvs_so], t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,IxXy,JxYz,yz->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,IxXy,Jy,Yx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,IxXy,JzYy,zx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,Ixyz,JXYy,zx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('I,Ixyz,JXyz,Yx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,IYXx,Jyxz,yz->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,IYxy,JXxz,yz->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,IYxy,Jx,yX->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('J,IYxy,Jzxy,zX->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,Ix,JXxy,Yy->IXJY', e_core_so[:ncvs_so], t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,Ix,Jx,YX->IXJY', e_core_so[:ncvs_so], t1_ca[:ncvs_so,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,Ix,JyYx,yX->IXJY', e_core_so[:ncvs_so], t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,IxXy,JxYz,yz->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,IxXy,Jy,Yx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,IxXy,JzYy,zx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,Ixyz,JXYy,zx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('J,Ixyz,JXyz,Yx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Ix,XY,Jyxz,yz->IXJY', h_ca_so[:ncvs_so,:], np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Jx,XY,Iyxz,zy->IXJY', h_ca_so[:ncvs_so,:], np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('iX,IJ,ixYy,xy->IXJY', h_ca_so, np.identity(ncvs_so), t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += einsum('iY,IJ,ix,xX->IXJY', h_ca_so, np.identity(ncvs_so), t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('iY,IJ,ixXy,yx->IXJY', h_ca_so, np.identity(ncvs_so), t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += einsum('ix,IJ,iY,xX->IXJY', h_ca_so, np.identity(ncvs_so), t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += einsum('ix,IJ,iXYy,xy->IXJY', h_ca_so, np.identity(ncvs_so), t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += einsum('ix,IJ,iYXy,yx->IXJY', h_ca_so, np.identity(ncvs_so), t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('ix,IJ,iYxy,yX->IXJY', h_ca_so, np.identity(ncvs_so), t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += einsum('ix,IJ,iyYx,yX->IXJY', h_ca_so, np.identity(ncvs_so), t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,IYxy,Jzyw,zw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,Iyxz,JyYw,zw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,Iyxz,Jz,Yy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,Iyxz,JwYz,wy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,JxYy,Izyw,wz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,Jxyz,IYyw,wz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,Jxyz,Iy,Yz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xx,Jxyz,Iwyz,Yw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IxXy,Jzyw,zw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,Ixyz,JXyw,zw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,Ixyz,Jy,zX->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yx,Ixyz,Jwyz,wX->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,JXxy,Izyw,wz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,Jyxz,IyXw,wz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,Jyxz,Iz,yX->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,Jyxz,IwXz,yw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,IYXx,Jzyw,zw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,IYxz,JXyw,zw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IYxz,JXzw,yw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,IYxz,Jy,zX->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IYxz,Jz,yX->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,IYxz,Jwyz,wX->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,Ix,JXyz,Yz->IXJY', h_aa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,Ix,Jy,YX->IXJY', h_aa_so, t1_ca[:ncvs_so,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,Ix,JzYy,zX->IXJY', h_aa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,IxXz,JyYw,zw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IxXz,Jz,Yy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IxXz,JwYz,wy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Ixzw,JXYz,wy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,Ixzw,JXzw,Yy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,IzXx,Jy,Yz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IzXx,JzYw,yw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,IzXx,JwYy,wz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,Izxw,JXYy,wz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Izxw,JXYw,yz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,Izxw,JXyw,Yz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,JXxz,IYzw,wy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,JXxz,Iz,Yy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,JxYz,Iz,yX->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,JxYz,IwXz,yw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jxzw,IYXz,yw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,Jxzw,IYzw,yX->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,JzYx,IzXw,wy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jzxw,IYXw,zy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,iX,iyYx,yx->IXJY', np.identity(ncvs_so), t1_ca, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,iY,ixXy,yx->IXJY', np.identity(ncvs_so), t1_ca, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,ix,iyYx,yX->IXJY', np.identity(ncvs_so), t1_ca, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,iXYx,iyxz,zy->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,iXxy,iYxz,zy->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,iYXx,izxy,zy->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,iYxy,izxy,zX->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,iYxy,iXxz,yz->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,ix,iYXy,yx->IXJY', np.identity(ncvs_so), t1_ca, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,ix,iYxy,yX->IXJY', np.identity(ncvs_so), t1_ca, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,ix,iXYy,xy->IXJY', np.identity(ncvs_so), t1_ca, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,ixXy,izYy,zx->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,ixYy,izXy,xz->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,ixyz,iYXy,xz->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,ixyz,iYyz,xX->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,ixyz,iXYy,zx->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('XY,Ix,Jzxy,zy->IXJY', np.identity(ncas_so), t1_ca[:ncvs_so,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XY,Ixyz,Jwyz,wx->IXJY', np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('XY,Jx,Iyxz,zy->IXJY', np.identity(ncas_so), t1_ca[:ncvs_so,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XY,Jxyz,Iwyz,xw->IXJY', np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('XY,ix,IiJy,yx->IXJY', np.identity(ncas_so), t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('XY,ix,JiIy,xy->IXJY', np.identity(ncas_so), t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('XY,ixyz,IiJy,xz->IXJY', np.identity(ncas_so), t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('XY,ixyz,JiIy,zx->IXJY', np.identity(ncas_so), t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('XxYy,Ixzw,Jz,wy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('XxYy,Ixzw,Juzw,uy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('XxYy,Izyw,Jw,xz->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('XxYy,Jx,Izyw,wz->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('XxYy,Jyzw,Iz,xw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('XxYy,Jyzw,Iuzw,xu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('XxYy,Jzxw,Iy,zw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('XxYy,Jzxw,Iw,zy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('XxYy,Jzxw,Iuyw,zu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,IYyw,Jzwu,xu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,IYyw,Jw,xz->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Xxyz,Iy,JzYw,xw->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xxyz,Iwyz,JwYu,xu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Iwyu,JzYu,xw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Xxyz,Jx,IYyw,wz->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Xxyz,Jx,Iy,Yz->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Jx,Iwyz,Yw->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,JyYw,Iw,xz->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xxyz,Jywu,IYwu,xz->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Xxyz,JwYx,Iy,wz->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,JwYx,Iuyz,wu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Jwxu,IYyz,wu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Xxyz,Jwxu,IYyu,wz->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Yxyz,Ix,JXyw,zw->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Yxyz,Ix,Jy,zX->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Ix,Jwyz,wX->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Yxyz,IyXw,Jz,wx->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,IyXw,Jw,zx->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,IyXw,Juzw,ux->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Iywu,JXzw,ux->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yxyz,Iywu,JXwu,zx->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Yxyz,IwXx,Jy,zw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,IwXx,Juyz,uw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Iwxu,JXyz,uw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Yxyz,Iwxu,JXyu,zw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,JXyw,Iw,zx->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yxyz,Jwyz,IwXu,ux->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xyzw,IYXx,Jz,wy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,IYXx,Juzw,uy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,IYxy,JXzu,wu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,IYxy,Jz,wX->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,IYxy,Juzw,uX->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,IYxu,JXzw,uy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xyzw,IYxu,JXzu,wy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xyzw,Ix,JXYz,wy->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,Ix,JXzw,Yy->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,Iuxy,JXYz,wu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Iuxy,JXzw,Yu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,XY,Ix,Jyxz,yz->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,XY,Ixyz,Jy,zx->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('I,XY,Ixyz,Jwyz,wx->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,XY,Ix,Jyxz,yz->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,XY,Ixyz,Jy,zx->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('J,XY,Ixyz,Jwyz,wx->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('i,IJ,iX,ixYy,xy->IXJY', e_core_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,iXYx,iyxz,zy->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,iXxy,iYxz,zy->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('i,IJ,iYXx,iy,xy->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,iYXx,iyxz,yz->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,iYxy,iXxz,yz->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,iYxy,ix,yX->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('i,IJ,iYxy,izxy,zX->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('i,IJ,ix,iY,xX->IXJY', e_core_so, np.identity(ncvs_so), t1_ca, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('i,IJ,ix,iXYy,xy->IXJY', e_core_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ix,iYxy,yX->IXJY', e_core_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,ix,iyYx,yX->IXJY', e_core_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += einsum('i,IJ,ixXy,iY,yx->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixXy,ixYz,yz->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixXy,izYy,zx->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,ixYy,ixXz,zy->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,ixYy,iy,xX->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixYy,izXy,xz->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixyz,iXYy,zx->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixyz,iYXy,xz->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('i,IJ,ixyz,iYyz,xX->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IJ,ix,iyYz,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,IJ,iYxy,iz,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IJ,iYxy,izyw,zw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IJ,ixYy,iz,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,IJ,ixYy,izyw,wz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,IJ,ixyz,iYyw,wz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IJ,iyxz,iY,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IJ,iyxz,iwYz,wy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,ix,iy,yX->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,ix,iyXz,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,iXxy,iz,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,iXxy,izyw,wz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,ixXy,iz,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,ixXy,izyw,zw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,ixyz,iXyw,zw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,ixyz,iy,zX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yx,IJ,ixyz,iwyz,wX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,iyxz,iX,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,iyxz,iz,yX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,iyxz,iwXz,yw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ix,iY,yX->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ix,iXYz,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ix,iYXz,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,IJ,ix,iYyz,zX->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,IJ,ix,izYy,zX->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,iXYx,iz,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,IJ,iXYx,izyw,wz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,IJ,iXxz,iYyw,wz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,iXxz,iYzw,wy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,iYXx,iz,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,IJ,iYXx,izyw,zw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,iYxz,iXzw,yw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,iYxz,iz,yX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,IJ,iYxz,iwyz,wX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixXz,iY,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixXz,iwYz,wy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixYz,iX,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,ixYz,iz,yX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixYz,iwXz,yw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixzw,iXYz,wy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixzw,iYXz,yw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,IJ,ixzw,iYzw,yX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,izXx,iY,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,IJ,izXx,iwYy,wz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,izYx,iX,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,izxw,iXYw,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,izxw,iYXw,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,XY,Ix,Jzyw,zw->IXJY', h_aa_so, np.identity(ncas_so), t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,XY,Ixzw,Jz,wy->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,XY,Ixzw,Juzw,uy->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,XY,Izxw,Jy,wz->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,XY,Izxw,Jw,yz->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,XY,Izxw,Juyw,uz->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,XY,Jxzw,Iz,yw->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,XY,Jxzw,Iuzw,yu->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,XY,Jzxw,Iw,zy->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,ix,iz,zy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,XxYy,ix,izyw,wz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,iy,iz,xz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,ixzw,iz,wy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,XxYy,ixzw,iuzw,uy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,iyzw,iz,xw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,XxYy,iyzw,iuzw,xu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,XxYy,izxw,iy,zw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,izxw,iw,zy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,XxYy,izxw,iuyw,zu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,izyw,iw,xz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,Xxyz,ix,iYyw,wz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iy,iY,xz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iy,izYw,xw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Xxyz,iYyz,iw,xw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iYyw,izwu,xu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iYyw,iw,xz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iyYw,iw,xz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iyYw,iuzw,xu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Xxyz,iywu,iYwu,xz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,Xxyz,iwYx,iy,wz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iwYx,iuyz,wu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iwxu,iYyz,wu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,Xxyz,iwxu,iYyu,wz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Xxyz,iwyz,iY,xw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,Yxyz,ix,iy,zX->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,Yxyz,ix,iXyw,zw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,ix,iwyz,wX->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iy,iX,zx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iy,izXw,wx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iXyz,iw,wx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iXyw,izwu,ux->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iXyw,iw,zx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iyXw,iw,zx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iyXw,iuzw,ux->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,iywu,iXwu,zx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,Yxyz,iwXx,iy,zw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iwXx,iuyz,uw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iwxu,iXyz,uw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,Yxyz,iwxu,iXyu,zw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,iwyz,iX,wx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,xyzw,ix,iXYz,wy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,xyzw,ix,iYXz,yw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,xyzw,ix,iYzw,yX->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,xyzw,iXYx,iuzw,yu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,xyzw,iXxy,iYzu,uw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,xyzw,iXxu,iYzw,yu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,xyzw,iXxu,iYzu,yw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,xyzw,iYXx,iuzw,uy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iYxy,iuzw,uX->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('XY,xyzw,Ix,Jz,wy->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ca[:ncvs_so,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XY,xyzw,Ix,Juzw,uy->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XY,xyzw,Iuxy,Jz,wu->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Iuxy,Jvzw,vu->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Ix,Jyxz,YyXz->IXJY', h_ca_so[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Jx,Iyxz,YzXy->IXJY', h_ca_so[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IYxy,Jwxz,ywXz->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Ix,Jzxy,YzXy->IXJY', t1_ca[:ncvs_so,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IxXy,Jwyz,Ywxz->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IxXy,Jxzw,Yyzw->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Ixyz,JwYy,zwXx->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Ixyz,JxYw,yzXw->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Ixyz,Jwyz,YwXx->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Ixyz,JXyw,Yzxw->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('JXxy,Izxw,Ywyz->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Jx,Iyxz,YzXy->IXJY', t1_ca[:ncvs_so,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('JxYy,Ixzw,zwXy->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('JxYy,Izyw,xwXz->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Jxyz,IYyw,xwXz->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Jxyz,IxXw,Ywyz->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Jxyz,IwXy,Yxzw->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Jxyz,Iwyz,YxXw->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('iXxy,IiJz,Yzxy->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('iYxy,JiIz,xyXz->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('ix,IiJy,YyXx->IXJY', t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('ix,JiIy,YxXy->IXJY', t1_ca, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('ixXy,JiIz,Yyxz->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('ixYy,IiJz,xzXy->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('ixyz,JiIY,yzXx->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('ixyz,IiJX,Yxyz->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('ixyz,IiJy,YxXz->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('ixyz,JiIy,YzXx->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,IYxy,Jzxw,yzXw->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,Ix,Jyxz,YyXz->IXJY', e_core_so[:ncvs_so], t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('I,IxXy,Jxzw,Yyzw->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,IxXy,Jzyw,Yzxw->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,Ixyz,JXyw,Yzxw->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('I,Ixyz,JxYw,yzXw->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,Ixyz,Jy,YzXx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,Ixyz,JwYy,zwXx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('I,Ixyz,Jwyz,YwXx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,IYxy,Jzxw,yzXw->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,Ix,Jyxz,YyXz->IXJY', e_core_so[:ncvs_so], t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('J,IxXy,Jxzw,Yyzw->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,IxXy,Jzyw,Yzxw->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,Ixyz,JXyw,Yzxw->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('J,Ixyz,JxYw,yzXw->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,Ixyz,Jy,YzXx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,Ixyz,JwYy,zwXx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('J,Ixyz,Jwyz,YwXx->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('iY,IJ,ixyz,yzXx->IXJY', h_ca_so, np.identity(ncvs_so), t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('ix,IJ,iYyz,yzXx->IXJY', h_ca_so, np.identity(ncvs_so), t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('ix,IJ,iyYz,xyXz->IXJY', h_ca_so, np.identity(ncvs_so), t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xx,Iyxz,Jywu,Yzwu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,Iyxz,Jwzu,Ywyu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,Jxyz,Iwyu,Yuzw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,Ixyz,Jwyu,zwXu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yx,Jyxz,Iywu,wuXz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,Jyxz,Iwzu,yuXw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xy,IYxz,Jwyu,zwXu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IYxz,Jwzu,ywXu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xy,Ix,Jzyw,YzXw->IXJY', h_aa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IxXz,Jywu,Yzwu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IxXz,Jwzu,Ywyu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Ixzw,JXzu,Ywyu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Ixzw,JyYu,zwXu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Ixzw,Jz,YwXy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Ixzw,JuYz,wuXy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,Ixzw,Juzw,YuXy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,IzXx,Jzwu,Yywu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xy,IzXx,Jwyu,Ywzu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xy,Izxw,JXyu,Ywzu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Izxw,JXwu,Yyzu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xy,Izxw,Jy,YwXz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Izxw,JzYu,ywXu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Izxw,Jw,YyXz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xy,Izxw,JuYy,wuXz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Izxw,JuYw,yuXz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xy,Izxw,Juyw,YuXz->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,JXxz,Iwzu,Yuyw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,JxYz,Iwzu,yuXw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jxzw,IYzu,yuXw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Jxzw,Iz,YyXw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Jxzw,IuXz,Yywu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,Jxzw,Iuzw,YyXu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,JzYx,Izwu,wuXy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jzxw,IYwu,zuXy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jzxw,IzXu,Yuyw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Jzxw,Iw,YzXy->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Jzxw,IuXw,Yzyu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,iY,ixyz,yzXx->IXJY', np.identity(ncvs_so), t1_ca, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,iXYx,iyzw,zwxy->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,iXxy,iYzw,zwxy->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,iYXx,iwyz,xwyz->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,iYxy,iwxz,ywXz->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,iYxy,iXzw,xyzw->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,ix,iYyz,yzXx->IXJY', np.identity(ncvs_so), t1_ca, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,ix,izYy,xzXy->IXJY', np.identity(ncvs_so), t1_ca, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,ixXy,iwYz,ywxz->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,ixYy,izXw,xwyz->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,ixYy,izyw,xwXz->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,ixyz,iYXw,xwyz->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,ixyz,iYyw,xwXz->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,ixyz,iwYy,zwXx->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,ixyz,iXYw,yzxw->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('XY,Ixyz,Juyw,zuxw->IXJY', np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,Ixyz,Jxwu,yzwu->IXJY', np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,Jxyz,Ixwu,wuyz->IXJY', np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('XY,Jxyz,Iwyu,xuzw->IXJY', np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('XY,ixyz,IiJw,xwyz->IXJY', np.identity(ncas_so), t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('XY,ixyz,JiIw,yzxw->IXJY', np.identity(ncas_so), t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XxYy,Ixzw,Jyuv,zwuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XxYy,Ixzw,Juzv,wuyv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XxYy,Izyw,Jzuv,xwuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XxYy,Izyw,Juwv,xuzv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XxYy,Jyzw,Iuzv,xvwu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XxYy,Jzxw,Izuv,uvyw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('XxYy,Jzxw,Iuyv,zvwu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XxYy,Jzxw,Iuwv,zvyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,IYyw,Jzuv,xwuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,IYyw,Juwv,xuzv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Ixwu,JyYv,wuzv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xxyz,Ixwu,Jw,Yuyz->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xxyz,Ixwu,JvYw,uvyz->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('Xxyz,Ixwu,Jvwu,Yvyz->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Iy,Jzwu,Yxwu->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Xxyz,Iwyz,Jwuv,Yxuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Xxyz,Iwyu,JzYv,xuwv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Iwyu,Jzuv,Yxwv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Iwyu,JwYv,xuzv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Iwyu,Ju,Yxzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Iwyu,JvYu,xvzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Xxyz,Jx,Iwyu,Yuzw->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,JyYw,Iuwv,xvzu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Jywu,IYwv,xvzu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Jywu,Iw,Yxzu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xxyz,Jywu,Ivwu,Yxzv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Xxyz,JwYx,Iwuv,uvyz->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Xxyz,JwYx,Iuyv,wvzu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Xxyz,Jwxu,IYyv,wvzu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xxyz,Jwxu,IYuv,wvyz->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Xxyz,Jwxu,Iy,Ywzu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xxyz,Jwxu,Iu,Ywyz->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Jwxu,Ivyz,Ywuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Xxyz,Jwxu,Ivyu,Ywzv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Yxyz,Ix,Jwyu,zwXu->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Yxyz,IyXw,Juzv,wuxv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,IyXw,Juwv,zuxv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Iywu,JXzv,wuxv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Iywu,JXwv,zuxv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Iywu,Jz,wuXx->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Iywu,Jw,zuXx->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Iywu,Jvzw,uvXx->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yxyz,Iywu,Jvwu,zvXx->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Yxyz,IwXx,Jwuv,yzuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Yxyz,IwXx,Juyv,zuwv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Yxyz,Iwxu,JXyv,zuwv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yxyz,Iwxu,JXuv,yzwv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Yxyz,Iwxu,Jy,zuXw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yxyz,Iwxu,Ju,yzXw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Iwxu,Jvyz,uvXw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Yxyz,Iwxu,Jvyu,zvXw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,JXyw,Iuwv,zvxu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Jxwu,IyXv,zvwu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yxyz,Jxwu,Iw,yzXu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yxyz,Jxwu,IvXw,yzuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('Yxyz,Jxwu,Ivwu,yzXv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Yxyz,Jwyz,Iwuv,uvXx->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Jwyu,IwXv,zvxu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Jwyu,Iu,zwXx->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Jwyu,IvXu,zwxv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IYXx,Jyuv,zwuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,IYXx,Juzv,wuyv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xyzw,IYxy,Juzv,wuXv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,IYxu,JXzv,wuyv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IYxu,JXuv,zwyv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IYxu,Jyuv,zwXv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xyzw,IYxu,Jz,wuXy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,IYxu,Ju,zwXy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xyzw,IYxu,Jvzw,uvXy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xyzw,IYxu,Jvzu,wvXy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xyzw,Ix,JXzu,Ywyu->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xyzw,Ix,JyYu,zwXu->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,Ix,Jz,YwXy->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,Ix,JuYz,wuXy->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xyzw,Ix,Juzw,YuXy->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,IxXu,Jy,Yuzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,IxXu,JzYv,yuwv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IxXu,Ju,Yyzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,IxXu,JvYy,uvzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IxXu,JvYu,yvzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,IxXu,Jvyu,Yvzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Ixuv,JXYy,uvzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Ixuv,JXYu,yvzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Ixuv,JXyu,Yvzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('xyzw,Ixuv,JXuv,Yyzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,IuXx,JyYv,zwuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,IuXx,Jz,Ywyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IuXx,JuYv,zwyv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,IuXx,JvYz,wvyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xyzw,IuXx,Jvzw,Yvyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,Iuxy,JXzv,Ywuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xyzw,Iuxy,Jz,YwXu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('xyzw,Iuxy,JuYv,zwXv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xyzw,Iuxy,JvYz,wvXu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Iuxy,Jvzw,YvXu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,Iuxv,JXYz,wvyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Iuxv,JXYv,zwyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xyzw,Iuxv,JXzw,Yvyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xyzw,Iuxv,JXzv,Ywyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Iuxv,JyYv,zwXu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,JXxu,IYuv,yvzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,JXxu,Iu,Yyzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,JxYu,Iu,zwXy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,JxYu,IvXu,zwyv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Jxuv,IYXu,zwyv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('xyzw,Jxuv,IYuv,zwXy->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,JuYx,IuXv,yvzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('xyzw,Juxy,IuXv,Yvzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Juxv,IYXv,yuzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('I,XY,Ixyz,Jxwu,yzwu->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,XY,Ixyz,Jwyu,zwxu->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('J,XY,Ixyz,Jxwu,yzwu->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,XY,Ixyz,Jwyu,zwxu->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,iYXx,iyzw,xyzw->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('i,IJ,iYxy,iXzw,xyzw->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,iYxy,iz,xyXz->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,iYxy,izxw,yzXw->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('i,IJ,ix,iyYz,xyXz->IXJY', e_core_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('i,IJ,ixXy,izYw,yzxw->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('i,IJ,ixYy,ixzw,zwXy->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixYy,izyw,xwXz->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixyz,iY,yzXx->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,ixyz,iXYw,yzxw->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixyz,iYyw,xwXz->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('i,IJ,ixyz,ixYw,yzXw->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,ixyz,iwYy,zwXx->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xx,IJ,iYxy,izwu,yzwu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xx,IJ,ixYy,izwu,wuyz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('Xx,IJ,ixyz,iYwu,wuyz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,IJ,iyxz,iwYu,zwyu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yx,IJ,ix,iyzw,zwXy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yx,IJ,iXxy,izwu,wuyz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yx,IJ,ixXy,izwu,yzwu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('Yx,IJ,ixyz,iXwu,yzwu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yx,IJ,ixyz,iw,yzXw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,ixyz,iwyu,zwXu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,iyxz,iw,ywXz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,iyxz,iwXu,yuzw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,iyxz,iwzu,yuXw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,IJ,ix,iYzw,zwXy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,ix,izYw,yzXw->IXJY', h_aa_so, np.identity(ncvs_so), t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,IJ,iXYx,izwu,wuyz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,IJ,iXxz,iYwu,wuyz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,IJ,iYXx,izwu,yzwu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,IJ,iYxz,iXwu,yzwu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,iYxz,iw,yzXw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xy,IJ,iYxz,iwyu,zwXu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,iYxz,iwzu,ywXu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,ixXz,iwYu,zwyu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,ixYz,iw,ywXz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,ixYz,iwXu,yuzw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixYz,iwzu,yuXw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,IJ,ixzw,iY,zwXy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,IJ,ixzw,iXYu,zwyu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,IJ,ixzw,iYXu,yuzw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixzw,iYzu,yuXw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,ixzw,iuYz,wuXy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,izXx,iwYu,ywzu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,izYx,iw,zwXy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,izYx,iwXu,zuyw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xy,IJ,izYx,iwyu,zuXw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,izxw,iY,ywXz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,izxw,iXYu,ywzu->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,izxw,iYXu,zuyw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,izxw,iYwu,zuXy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,izxw,iuYw,yuXz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,XY,Ixzw,Jyuv,zwuv->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,XY,Ixzw,Juzv,wuyv->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,XY,Izxw,Jzuv,ywuv->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xy,XY,Izxw,Juyv,wuzv->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,XY,Izxw,Juwv,yuzv->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,XY,Jxzw,Iuzv,yvwu->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,XY,Jzxw,Izuv,uvyw->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,XY,Jzxw,Iuwv,zvyu->IXJY', h_aa_so, np.identity(ncas_so), t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,XxYy,ix,izwu,wuyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,XxYy,iy,izwu,xzwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,XxYy,ixzw,iu,zwyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,XxYy,ixzw,iuzv,wuyv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,XxYy,iyzw,iu,xuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,XxYy,iyzw,iuzv,xvwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,izxw,iu,zuyw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,XxYy,izxw,iuyv,zvwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,XxYy,izxw,iuwv,zvyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,izyw,iu,xwzu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,XxYy,izyw,iuwv,xuzv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Xxyz,ix,iYwu,wuyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iy,iwYu,xwzu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,Xxyz,iYyz,iwuv,xwuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Xxyz,iYyw,izuv,xwuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iYyw,iu,xwzu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iYyw,iuwv,xuzv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Xxyz,ixwu,iY,wuyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Xxyz,ixwu,ivYw,uvyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iyYw,iu,xuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iyYw,iuzv,xvwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iyYw,iuwv,xvzu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iywu,iYwv,xvzu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Xxyz,iwYx,iu,wuyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,Xxyz,iwYx,iuyv,wvzu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,Xxyz,iwxu,iYyv,wvzu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Xxyz,iwxu,iYuv,wvyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Xxyz,iwyz,iuYv,xuwv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iwyu,iY,xuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iwyu,ivYu,xvzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Yxyz,ix,iXwu,yzwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,ix,iw,yzXw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,Yxyz,ix,iwyu,zwXu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iy,izwu,wuXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iy,iw,zwXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iy,iwXu,zuxw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,Yxyz,iXyz,iwuv,uvxw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,iXyw,izuv,uvxw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iXyw,iu,zuxw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iXyw,iuwv,zvxu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Yxyz,ixwu,iX,yzwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,ixwu,iw,yzXu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,ixwu,ivXw,yzuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,Yxyz,ixwu,ivwu,yzXv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iyXw,iu,zwxu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iyXw,iuzv,wuxv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iyXw,iuwv,zuxv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iywu,iXwv,zuxv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iywu,iw,zuXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iywu,ivzw,uvXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iywu,ivwu,zvXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iwXx,iu,yzwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,Yxyz,iwXx,iuyv,zuwv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,Yxyz,iwxu,iy,zuXw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,Yxyz,iwxu,iXyv,zuwv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iwxu,iXuv,yzwv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,iwxu,iu,yzXw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iwxu,ivyz,uvXw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,Yxyz,iwxu,ivyu,zvXw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iwyz,iu,wuXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iwyz,iuXv,wvxu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iwyu,iX,zwxu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iwyu,iu,zwXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iwyu,ivXu,zwxv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ix,iY,zwXy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ix,iXYu,zwyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ix,iYXu,yuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,xyzw,ix,iYzu,yuXw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ix,iyYu,zwXu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,xyzw,ix,iuYz,wuXy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,iXYx,iyuv,uvzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iXYx,iu,yuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,xyzw,iXYx,iuzv,yvwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.0625 * einsum('IJ,xyzw,iXxy,iYuv,uvzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,xyzw,iXxu,iYzv,yvwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iXxu,iYuv,yvzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,iYXx,iyuv,zwuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iYXx,iu,zwyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,xyzw,iYXx,iuzv,wuyv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.0625 * einsum('IJ,xyzw,iYxy,iXuv,zwuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,iYxy,iu,zwXu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,xyzw,iYxy,iuzv,wuXv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iYxu,iXuv,zwyv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iYxu,iyuv,zwXv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iYxu,iu,zwXy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,xyzw,iYxu,ivzw,uvXy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,xyzw,iYxu,ivzu,wvXy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixXu,iY,yuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ixXu,ivYy,uvzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixXu,ivYu,yvzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixYu,iX,zwyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixYu,iu,zwXy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ixYu,ivXy,zwuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixYu,ivXu,zwyv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ixYu,ivyu,zwXv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixuv,iXYu,yvzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixuv,iYXu,zwyv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,xyzw,ixuv,iYuv,zwXy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iuXx,iY,zwyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,xyzw,iuXx,ivYz,wvyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iuYx,iX,yuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,xyzw,iuYx,ivzw,yuXv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,xyzw,iuxy,iY,zwXu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,iuxy,iXYv,zwuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,iuxy,iYXv,uvzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iuxv,iXYv,zwyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iuxv,iYXv,yuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Ix,Jyuv,zwuv->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('XY,xyzw,Ix,Juzv,wuyv->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Ixuv,Jy,uvzw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Ixuv,Ju,yvzw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Ixuv,Jsyu,vszw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('XY,xyzw,Ixuv,Jsuv,yszw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.0625 * einsum('XY,xyzw,Iuxy,Juvs,zwvs->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('XY,xyzw,Iuxy,Jvzs,wvus->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Iuxv,Jyvs,zwus->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('XY,xyzw,Iuxv,Jz,wvyu->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Iuxv,Jv,zwyu->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XY,xyzw,Iuxv,Jszw,vsyu->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('XY,xyzw,Iuxv,Jszv,wsyu->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Jxuv,Iu,zwyv->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('XY,xyzw,Jxuv,Isuv,zwys->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.0625 * einsum('XY,xyzw,Juxy,Iuvs,vszw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Juxv,Iv,yuzw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Ixyz,Juyw,YzuXxw->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Ixyz,Jxwu,YyzXwu->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Jxyz,Ixwu,YwuXyz->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= einsum('Jxyz,Iwyu,YxuXzw->IXJY', t1_caaa[:ncvs_so,:,:,:], v_caaa_so[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('ixyz,IiJw,YxwXyz->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('ixyz,JiIw,YyzXxw->IXJY', t1_caaa, v_ccca_so[:ncvs_so,:,:ncvs_so,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('I,Ixyz,Jxwu,YyzXwu->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,Ixyz,Jwyu,YzwXxu->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('J,Ixyz,Jxwu,YyzXwu->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,Ixyz,Jwyu,YzwXxu->IXJY', e_core_so[:ncvs_so], t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,Ixzw,Jyuv,YzwXuv->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Ixzw,Juzv,YwuXyv->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,Izxw,Jzuv,YywXuv->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= einsum('xy,Izxw,Juyv,YwuXzv->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Izxw,Juwv,YyuXzv->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Jxzw,Iuzv,YyvXwu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,Jzxw,Izuv,YuvXyw->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Jzxw,Iuwv,YzvXyu->IXJY', h_aa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,iYxy,iuzw,xyuXzw->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,ixYy,izwu,xwuXyz->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,ixyz,iYwu,xwuXyz->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,ixyz,iuYw,yzuXxw->IXJY', np.identity(ncvs_so), t1_caaa, v_caaa_so, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xxyz,Ixwu,Jyvs,Ywuzvs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xxyz,Ixwu,Jvws,Yuvyzs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Iwyu,Jzvs,Yxuwvs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xxyz,Iwyu,Jwvs,Yxuzvs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Iwyu,Jvus,Yxvzws->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Jywu,Ivws,Yxszuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Xxyz,Jwxu,Iwvs,Yvsyzu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += einsum('Xxyz,Jwxu,Ivys,Ywszuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xxyz,Jwxu,Ivus,Ywsyzv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Iywu,Jvzs,wuvXxs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Iywu,Jvws,zuvXxs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Yxyz,Iwxu,Jwvs,yzuXvs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += einsum('Yxyz,Iwxu,Jvys,zuvXws->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yxyz,Iwxu,Jvus,yzvXws->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yxyz,Jxwu,Iyvs,zvsXwu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yxyz,Jxwu,Ivws,yzsXuv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yxyz,Jwyu,Iwvs,zvsXxu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Jwyu,Ivus,zwsXxv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IYxu,Jyvs,zwuXvs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += einsum('xyzw,IYxu,Jvzs,wuvXys->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,IYxu,Jvus,zwvXys->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Ix,Jyuv,YzwXuv->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,Ix,Juzv,YwuXyv->IXJY', v_aaaa_so, t1_ca[:ncvs_so,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xyzw,IxXu,Jzvs,Yyuwvs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,IxXu,Jvys,Yuvzws->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IxXu,Jvus,Yyvzws->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Ixuv,JXys,Yuvzws->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Ixuv,JXus,Yyvzws->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Ixuv,Jy,YuvXzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xyzw,Ixuv,JzYs,yuvXws->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Ixuv,Ju,YyvXzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Ixuv,JsYy,uvsXzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Ixuv,JsYu,yvsXzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Ixuv,Jsyu,YvsXzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('xyzw,Ixuv,Jsuv,YysXzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,IuXx,Jyvs,Yzwuvs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('xyzw,IuXx,Juvs,Yzwyvs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,IuXx,Jvzs,Ywvyus->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.0625 * einsum('xyzw,Iuxy,Juvs,YzwXvs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xyzw,Iuxy,Jvzs,YwvXus->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,Iuxv,JXzs,Ywvyus->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Iuxv,JXvs,Yzwyus->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,Iuxv,JyYs,zwvXus->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Iuxv,Jyvs,YzwXus->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,Iuxv,Jz,YwvXyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Iuxv,JuYs,zwvXys->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Iuxv,Jv,YzwXyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += einsum('xyzw,Iuxv,JsYz,wvsXyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Iuxv,JsYv,zwsXyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,Iuxv,Jszw,YvsXyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,Iuxv,Jszv,YwsXyu->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,JXxu,Ivus,Yyszwv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,JxYu,Ivus,zwsXyv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Jxuv,IYus,zwsXyv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Jxuv,Iu,YzwXyv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Jxuv,IsXu,Yzwyvs->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('xyzw,Jxuv,Isuv,YzwXys->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('xyzw,JuYx,Iuvs,yvsXzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.0625 * einsum('xyzw,Juxy,Iuvs,YvsXzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Juxv,IYvs,yusXzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Juxv,IuXs,Yyszwv->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Juxv,Iv,YyuXzw->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_ca[:ncvs_so,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Juxv,IsXv,Yyuzws->IXJY', v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('i,IJ,iYxy,izwu,xyzXwu->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixyz,iwYu,yzwXxu->IXJY', e_core_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Yx,IJ,ixyz,iwuv,yzwXuv->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yx,IJ,iyxz,iwuv,yuvXzw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,IJ,iYxz,iwuv,yzwXuv->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,IJ,ixYz,iwuv,yuvXzw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('xy,IJ,ixzw,iYuv,yuvXzw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,IJ,ixzw,iuYv,zwuXyv->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,IJ,izYx,iwuv,zuvXyw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,IJ,izxw,iYuv,zuvXyw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,izxw,iuYv,ywuXzv->IXJY', h_aa_so, np.identity(ncvs_so), t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,XxYy,ixzw,iuvs,zwuyvs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,XxYy,iyzw,iuvs,xvszwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,XxYy,izxw,iuvs,zvsywu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,XxYy,izyw,iuvs,xwuzvs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Xxyz,iYyw,iuvs,xwuzvs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Xxyz,ixwu,ivYs,wuvyzs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Xxyz,iyYw,iuvs,xvszwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Xxyz,iywu,iYvs,xvszwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Xxyz,iwYx,iuvs,wvsyzu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Xxyz,iwxu,iYvs,wvsyzu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iwyu,ivYs,xuvzws->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,Yxyz,ix,iwuv,yzwXuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iy,iwuv,zuvXxw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,iXyw,iuvs,zvsxwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,Yxyz,ixwu,iv,yzvXwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Yxyz,ixwu,ivXs,yzswuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,ixwu,ivws,yzsXuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iyXw,iuvs,zwuxvs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Yxyz,iywu,iXvs,zwuxvs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iywu,iv,zwuXxv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,iywu,ivzs,wuvXxs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iywu,ivws,zuvXxs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Yxyz,iwXx,iuvs,yzuwvs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Yxyz,iwxu,iXvs,yzuwvs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iwxu,iv,yzuXwv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_cccaaa_so, optimize = einsum_type)
        temp -= einsum('IJ,Yxyz,iwxu,ivys,zuvXws->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,iwxu,ivus,yzvXws->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Yxyz,iwyz,iuvs,wvsXxu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iwyu,iv,zwvXxu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iwyu,ivXs,zwsxuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iwyu,ivus,zwsXxv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,ix,iYuv,yuvXzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ix,iuYv,zwuXyv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ca, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,iXYx,iuvs,yvszwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,iXxu,iYvs,yvszwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,iYXx,iuvs,zwuyvs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.0625 * einsum('IJ,xyzw,iYxy,iuvs,zwuXvs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,iYxu,iXvs,zwuyvs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,iYxu,iyvs,zwuXvs->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iYxu,iv,zwuXyv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_cccaaa_so, optimize = einsum_type)
        temp -= einsum('IJ,xyzw,iYxu,ivzs,wuvXys->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iYxu,ivus,zwvXys->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixXu,ivYs,yuvzws->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ixYu,iv,zwvXyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixYu,ivXs,zwsyuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ixYu,ivys,zwsXuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixYu,ivus,zwsXyv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,ixuv,iY,yuvXzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,ixuv,iXYs,yuvzws->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,ixuv,iYXs,zwsyuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixuv,iYus,zwsXyv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,ixuv,isYy,uvsXzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ixuv,isYu,yvsXzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iuXx,ivYs,zwvyus->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iuYx,iv,yuvXzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iuYx,ivXs,yuszwv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += einsum('IJ,xyzw,iuYx,ivzs,yusXwv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.0625 * einsum('IJ,xyzw,iuxy,iYvs,uvsXzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,xyzw,iuxy,ivYs,zwvXus->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iuxv,iY,zwvXyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_ca, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iuxv,iXYs,zwvyus->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iuxv,iYXs,yuszwv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iuxv,iYvs,yusXzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iuxv,isYv,zwsXyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, t1_caaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Ixuv,Jzst,yuvwst->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Ixuv,Jsyt,uvszwt->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Ixuv,Jsut,yvszwt->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Iuxv,Jyst,zwvust->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('XY,xyzw,Iuxv,Just,zwvyst->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += einsum('XY,xyzw,Iuxv,Jszt,wvsyut->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Iuxv,Jsvt,zwsyut->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Jxuv,Isut,zwtyvs->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('XY,xyzw,Juxv,Iust,ystzwv->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Juxv,Isvt,yutzws->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Ixuv,Jzst,YuvXstxz->IXJY', t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], m_00_int1, optimize = einsum_type)
        temp -= 0.25 * einsum('Ixuv,Jsyt,YuvsXtxy->IXJY', t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], m_00_int2, optimize = einsum_type)
        temp -= 0.25 * einsum('Iuxv,Jyst,tsuXvYxy->IXJY', t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], m_00_int2, optimize = einsum_type)
        temp -= 0.25 * einsum('Ixuv,Jsut,YvsXtx->IXJY', t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], m_00_int3, optimize = einsum_type)
        temp += 0.125 * einsum('Iuxv,Just,tsXvYx->IXJY', t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], m_00_int3, optimize = einsum_type)
        temp -= 0.25 * einsum('Iuxv,Jsvt,tuXsYx->IXJY', t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], m_00_int3, optimize = einsum_type)
        temp -= 0.25 * einsum('Jxuv,Isut,svXtYx->IXJY', t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], m_00_int3, optimize = einsum_type)
        temp += 0.125 * einsum('Juxv,Iust,YstXvx->IXJY', t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], m_00_int3, optimize = einsum_type)
        temp -= 0.25 * einsum('Juxv,Isvt,YutXsx->IXJY', t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], m_00_int3, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,iYxu,ivst,tsXvux->IXJY', np.identity(ncvs_so), t1_caaa, t1_caaa, m_00_int3, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,ixYu,ivst,vuXtsx->IXJY', np.identity(ncvs_so), t1_caaa, t1_caaa, m_00_int3, optimize = einsum_type)
        temp -= 0.0625 * einsum('IJ,ixuv,iYst,vuXtsx->IXJY', np.identity(ncvs_so), t1_caaa, t1_caaa, m_00_int3, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,ixuv,isYt,uvsXtx->IXJY', np.identity(ncvs_so), t1_caaa, t1_caaa, m_00_int3, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,iuYx,ivst,ustXvx->IXJY', np.identity(ncvs_so), t1_caaa, t1_caaa, m_00_int3, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,iuxv,iYst,ustXvx->IXJY', np.identity(ncvs_so), t1_caaa, t1_caaa, m_00_int3, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,iuxv,isYt,tuXsvx->IXJY', np.identity(ncvs_so), t1_caaa, t1_caaa, m_00_int3, optimize = einsum_type)
        temp += einsum('Iuxv,Jszt,YvsXutxz->IXJY', t1_caaa[:ncvs_so,:,:,:], t1_caaa[:ncvs_so,:,:,:], m_00_int4, optimize = einsum_type)
        temp -= 0.0625 * einsum('IJ,Yxyz,ixwu,uwXzyi->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, m_00_int6, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Yxyz,iywu,zwuXxi->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, m_00_int6, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Yxyz,iwxu,yzuXwi->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, m_00_int6, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,iwyu,uxXwzi->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caaa, m_00_int6, optimize = einsum_type)
