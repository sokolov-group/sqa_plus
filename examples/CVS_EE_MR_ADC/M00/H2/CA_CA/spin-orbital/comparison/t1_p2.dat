        temp += einsum('IiXx,JiYx->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += einsum('JiYx,IiXx->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('I,IiXx,JiYx->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('J,IiXx,JiYx->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('i,IiXx,JiYx->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('i,JiYx,IiXx->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('Xx,Iixy,JiYy->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('Yx,Jixy,IiXy->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += einsum('xy,IiXx,JiYy->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,ijXx,ijYx->IXJY', np.identity(ncvs_so), t1_ccaa, v_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,ijYx,ijXx->IXJY', np.identity(ncvs_so), t1_ccaa, v_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XY,Iixy,Jixy->IXJY', np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('XY,Jixy,Iixy->IXJY', np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= einsum('XxYy,Jixz,Iiyz->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,JiYx,Iiyz->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,IiXx,Jiyz->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.25 * einsum('I,XY,Iixy,Jixy->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.25 * einsum('J,XY,Iixy,Jixy->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ijXx,ijYx->IXJY', e_core_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ijYx,ijXx->IXJY', e_core_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, optimize = einsum_type)
        temp += 0.25 * einsum('i,XY,Iixy,Jixy->IXJY', e_core_so, np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.25 * einsum('i,XY,Jixy,Iixy->IXJY', e_core_so, np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.25 * einsum('Xx,IJ,ijxy,ijYy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, optimize = einsum_type)
        temp -= 0.25 * einsum('Yx,IJ,ijxy,ijXy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,ijXx,ijYy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, optimize = einsum_type)
        temp -= einsum('xy,XY,Iixz,Jiyz->IXJY', h_aa_so, np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('IJ,XxYy,ijxz,ijyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Xxyz,ijYx,ijyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,ijXx,ijyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Iixy,Jizw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= einsum('IiXx,JiYy,xy->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('IiXx,Jixy,Yy->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Iixy,JiYx,yX->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Iixy,Jixy,YX->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('JiYx,IiXy,yx->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('JiYx,Iixy,yX->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Jixy,IiXx,Yy->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Jixy,Iixy,YX->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,IiXx,JiYy,xy->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,IiXx,Jixy,Yy->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,Iixy,JiYx,yX->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('I,Iixy,Jixy,YX->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,IiXx,JiYy,xy->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,IiXx,Jixy,Yy->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,Iixy,JiYx,yX->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('J,Iixy,Jixy,YX->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('i,IiXx,JiYy,xy->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IiXx,Jixy,Yy->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,Iixy,JiYx,yX->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('i,Iixy,Jixy,YX->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,JiYx,Iixy,yX->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,Jixy,IiXx,Yy->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('i,Jixy,Iixy,YX->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,Iixy,JiYz,yz->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,Iixy,Jiyz,Yz->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,Jixy,IiXz,zy->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,Jixy,Iiyz,zX->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IiXx,JiYz,yz->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,IiXx,Jiyz,Yz->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,Iixz,JiYy,zX->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Iixz,JiYz,yX->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,Iixz,Jiyz,YX->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,JiYx,IiXz,zy->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jixz,IiXz,Yy->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,ijXx,ijYy,xy->IXJY', np.identity(ncvs_so), t1_ccaa, v_ccaa_so, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,ijYx,ijXy,yx->IXJY', np.identity(ncvs_so), t1_ccaa, v_ccaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,ijYx,ijxy,yX->IXJY', np.identity(ncvs_so), t1_ccaa, v_ccaa_so, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,ijxy,ijYx,yX->IXJY', np.identity(ncvs_so), t1_ccaa, v_ccaa_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('XY,Iixy,Jixz,yz->IXJY', np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('XY,Jixy,Iixz,zy->IXJY', np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XxYy,Iiyz,Jizw,xw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('XxYy,Jixz,Iiyw,wz->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XxYy,Jixz,Iizw,wy->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xxyz,Iiyz,JiYw,xw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Iiyw,JiYw,xz->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Xxyz,JiYx,Iiyw,wz->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Jixw,Iiyz,Yw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Xxyz,Jixw,Iiyw,Yz->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Yxyz,IiXx,Jiyw,zw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Iixw,Jiyz,wX->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Yxyz,Iixw,Jiyw,zX->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yxyz,Jiyz,IiXw,wx->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Jiyw,IiXw,zx->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xyzw,IiXx,JiYz,wy->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,IiXx,Jizw,Yy->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,Iixy,JiYz,wX->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Iixy,Jizw,YX->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,XY,Iixy,Jixz,yz->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,XY,Iixy,Jixz,yz->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,ijXx,ijYy,xy->IXJY', e_core_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,ijYx,ijXy,yx->IXJY', e_core_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ijYx,ijxy,yX->IXJY', e_core_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ijxy,ijYx,yX->IXJY', e_core_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,XY,Iixy,Jixz,yz->IXJY', e_core_so, np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,XY,Jixy,Iixz,zy->IXJY', e_core_so, np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xx,IJ,ijxy,ijYz,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yx,IJ,ijxy,ijXz,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yx,IJ,ijxy,ijyz,zX->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,IJ,ijXx,ijYz,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,IJ,ijYx,ijXz,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,ijYx,ijyz,zX->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,IJ,ijxz,ijYz,yX->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,XY,Iixz,Jiyw,zw->IXJY', h_aa_so, np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,XY,Iixz,Jizw,yw->IXJY', h_aa_so, np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,XY,Jixz,Iizw,wy->IXJY', h_aa_so, np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,ijxz,ijyw,wz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,XxYy,ijxz,ijzw,wy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,XxYy,ijyz,ijzw,xw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,ijYx,ijyw,wz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Xxyz,ijyz,ijYw,xw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Xxyz,ijyw,ijYw,xz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,ijXx,ijyw,zw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,ijxw,ijyz,wX->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,ijxw,ijyw,zX->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Yxyz,ijyz,ijXw,wx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,ijyw,ijXw,zx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,xyzw,ijXx,ijYz,wy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ijYx,ijzw,yX->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('XY,xyzw,Iixy,Jizu,wu->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('XY,xyzw,Iixu,Jizw,uy->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('XY,xyzw,Iixu,Jizu,wy->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IiXx,Jiyz,Yxyz->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Iixy,JiYz,xyXz->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Iixy,Jixz,YyXz->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('JiYx,Iiyz,yzXx->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Jixy,IiXz,Yzxy->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Jixy,Iixz,YzXy->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('I,IiXx,Jiyz,Yxyz->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('I,Iixy,JiYz,xyXz->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,Iixy,Jixz,YyXz->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('J,IiXx,Jiyz,Yxyz->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('J,Iixy,JiYz,xyXz->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,Iixy,Jixz,YyXz->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IiXx,Jiyz,Yxyz->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,Iixy,JiYz,xyXz->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,Iixy,Jixz,YyXz->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,Jixy,Iixz,YzXy->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xx,Iixy,Jizw,Yyzw->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yx,Jixy,Iizw,zwXy->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,IiXx,Jizw,Yyzw->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Iixz,JiYw,yzXw->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xy,Iixz,Jiyw,YzXw->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Iixz,Jizw,YyXw->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,JiYx,Iizw,zwXy->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jixz,IiXw,Ywyz->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jixz,Iizw,YwXy->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,ijYx,ijyz,yzXx->IXJY', np.identity(ncvs_so), t1_ccaa, v_ccaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,ijxy,ijYz,xyXz->IXJY', np.identity(ncvs_so), t1_ccaa, v_ccaa_so, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,Iixy,Jizw,xyzw->IXJY', np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,Jixy,Iizw,zwxy->IXJY', np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XxYy,Iiyz,Jiwu,xzwu->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XxYy,Jixz,Iiwu,wuyz->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Xxyz,Iiyz,Jiwu,Yxwu->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Iiyw,JiYu,xwzu->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Iiyw,Jiwu,Yxzu->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Xxyz,JiYx,Iiwu,wuyz->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Xxyz,Jixw,Iiyu,Yuzw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xxyz,Jixw,Iiwu,Yuyz->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Yxyz,IiXx,Jiwu,yzwu->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Yxyz,Iixw,Jiyu,zwXu->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yxyz,Iixw,Jiwu,yzXu->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Yxyz,Jiyz,Iiwu,wuXx->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Jiyw,IiXu,zuxw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Jiyw,Iiwu,zuXx->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IiXx,JiYu,zwyu->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xyzw,IiXx,Jizu,Ywyu->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('xyzw,Iixy,JiYu,zwXu->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,Iixy,Jizu,YwXu->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xyzw,Iixu,JiYz,wuXy->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Iixu,JiYu,zwXy->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xyzw,Iixu,Jizw,YuXy->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,Iixu,Jizu,YwXy->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,JiYx,IiXu,yuzw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('xyzw,Jixy,IiXu,Yuzw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Jixu,IiXu,Yyzw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('I,XY,Iixy,Jizw,xyzw->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('J,XY,Iixy,Jizw,xyzw->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('i,IJ,ijYx,ijyz,yzXx->IXJY', e_core_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('i,IJ,ijxy,ijYz,xyXz->IXJY', e_core_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('i,XY,Iixy,Jizw,xyzw->IXJY', e_core_so, np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('Yx,IJ,ijxy,ijzw,zwXy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('xy,IJ,ijYx,ijzw,zwXy->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,IJ,ijxz,ijYw,yzXw->IXJY', h_aa_so, np.identity(ncvs_so), t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,XY,Iixz,Jiwu,yzwu->IXJY', h_aa_so, np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xy,XY,Jixz,Iiwu,wuyz->IXJY', h_aa_so, np.identity(ncas_so), t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,XxYy,ijxz,ijwu,wuyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,XxYy,ijyz,ijwu,xzwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.0625 * einsum('IJ,Xxyz,ijYx,ijwu,wuyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Xxyz,ijyw,ijYu,xwzu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.0625 * einsum('IJ,Yxyz,ijXx,ijwu,yzwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,ijxw,ijyu,zwXu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,Yxyz,ijxw,ijwu,yzXu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.0625 * einsum('IJ,Yxyz,ijyz,ijwu,wuXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,ijyw,ijXu,zuxw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,ijyw,ijwu,zuXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,ijXx,ijYu,zwyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,ijYx,ijXu,yuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,xyzw,ijYx,ijzu,yuXw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.0625 * einsum('IJ,xyzw,ijxy,ijYu,zwXu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,xyzw,ijxu,ijYu,zwXy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.0625 * einsum('XY,xyzw,Iixy,Jiuv,zwuv->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('XY,xyzw,Iixu,Jizv,wuyv->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Iixu,Jiuv,zwyv->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.0625 * einsum('XY,xyzw,Jixy,Iiuv,uvzw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Jixu,Iiuv,yvzw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Iixy,Jizw,YxyXzw->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Jixy,Iizw,YzwXxy->IXJY', t1_ccaa[:ncvs_so,:,:,:], v_ccaa_so[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('I,Iixy,Jizw,YxyXzw->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('J,Iixy,Jizw,YxyXzw->IXJY', e_core_so[:ncvs_so], t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('i,Iixy,Jizw,YxyXzw->IXJY', e_core_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,Iixz,Jiwu,YyzXwu->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xy,Jixz,Iiwu,YwuXyz->IXJY', h_aa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xxyz,Iiyw,Jiuv,Yxwzuv->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Xxyz,Jixw,Iiuv,Yuvyzw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('Yxyz,Iixw,Jiuv,yzwXuv->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yxyz,Jiyw,Iiuv,zuvXxw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('xyzw,IiXx,Jiuv,Yzwyuv->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.0625 * einsum('xyzw,Iixy,Jiuv,YzwXuv->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Iixu,JiYv,zwuXyv->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += einsum('xyzw,Iixu,Jizv,YwuXyv->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Iixu,Jiuv,YzwXyv->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('xyzw,JiYx,Iiuv,yuvXzw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.0625 * einsum('xyzw,Jixy,Iiuv,YuvXzw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Jixu,IiXv,Yyvzwu->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Jixu,Iiuv,YyvXzw->IXJY', v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.0625 * einsum('IJ,Yxyz,ijxw,ijuv,yzwXuv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('IJ,Yxyz,ijyw,ijuv,zuvXxw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.0625 * einsum('IJ,xyzw,ijYx,ijuv,yuvXzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('IJ,xyzw,ijxu,ijYv,zwuXyv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_ccaa, t1_ccaa, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('XY,xyzw,Iixu,Jivs,zwuyvs->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.125 * einsum('XY,xyzw,Jixu,Iivs,yvszwu->IXJY', np.identity(ncas_so), v_aaaa_so, t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.125 * einsum('Iixu,Jivs,svXuYx->IXJY', t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], m_00_int3, optimize = einsum_type)
        temp += 0.125 * einsum('Jixu,Iivs,YvsXux->IXJY', t1_ccaa[:ncvs_so,:,:,:], t1_ccaa[:ncvs_so,:,:,:], m_00_int3, optimize = einsum_type)
