        temp -= einsum('Ia,JXaY->IXJY', h_ce_so[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= einsum('Ja,IYaX->IXJY', h_ce_so[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += einsum('IYax,JXxa->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += einsum('Ia,JXYa->IXJY', t1_ce[:ncvs_so,:], v_caae_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += einsum('JXax,IYxa->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += einsum('Ja,IYXa->IXJY', t1_ce[:ncvs_so,:], v_caae_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= einsum('iXaY,IiJa->IXJY', t1_caea, v_ccce_so[:ncvs_so,:,:ncvs_so,:], optimize = einsum_type)
        temp -= einsum('iYaX,JiIa->IXJY', t1_caea, v_ccce_so[:ncvs_so,:,:ncvs_so,:], optimize = einsum_type)
        temp += 0.5 * einsum('I,IYaX,Ja->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], optimize = einsum_type)
        temp += 0.5 * einsum('I,IYax,JXax->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('I,Ia,JXaY->IXJY', e_core_so[:ncvs_so], t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('J,IYaX,Ja->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], optimize = einsum_type)
        temp += 0.5 * einsum('J,IYax,JXax->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('J,Ia,JXaY->IXJY', e_core_so[:ncvs_so], t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= einsum('a,JXaY,Ia->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], optimize = einsum_type)
        temp -= einsum('a,JXax,IYax->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= einsum('a,Ja,IYaX->IXJY', e_extern_so, t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= einsum('Ia,XY,Ja->IXJY', h_ce_so[:ncvs_so,:], np.identity(ncas_so), t1_ce[:ncvs_so,:], optimize = einsum_type)
        temp -= einsum('Ja,XY,Ia->IXJY', h_ce_so[:ncvs_so,:], np.identity(ncas_so), t1_ce[:ncvs_so,:], optimize = einsum_type)
        temp += einsum('ia,IJ,iXaY->IXJY', h_ce_so, np.identity(ncvs_so), t1_caea, optimize = einsum_type)
        temp += einsum('ia,IJ,iYaX->IXJY', h_ce_so, np.identity(ncvs_so), t1_caea, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IYax,Ja->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], optimize = einsum_type)
        temp += 0.5 * einsum('Xx,JxaY,Ia->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], optimize = einsum_type)
        temp += 0.5 * einsum('Xx,Jxay,IYay->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IxaX,Ja->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], optimize = einsum_type)
        temp += 0.5 * einsum('Yx,Ixay,JXay->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,JXax,Ia->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], optimize = einsum_type)
        temp -= einsum('xy,IYax,JXay->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= einsum('IJ,iXax,iYxa->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, optimize = einsum_type)
        temp -= einsum('IJ,iYax,iXxa->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, optimize = einsum_type)
        temp -= einsum('IJ,ia,iYXa->IXJY', np.identity(ncvs_so), t1_ce, v_caae_so, optimize = einsum_type)
        temp -= einsum('IJ,ia,iXYa->IXJY', np.identity(ncvs_so), t1_ce, v_caae_so, optimize = einsum_type)
        temp -= einsum('XY,ia,IiJa->IXJY', np.identity(ncas_so), t1_ce, v_ccce_so[:ncvs_so,:,:ncvs_so,:], optimize = einsum_type)
        temp -= einsum('XY,ia,JiIa->IXJY', np.identity(ncas_so), t1_ce, v_ccce_so[:ncvs_so,:,:ncvs_so,:], optimize = einsum_type)
        temp += 0.5 * einsum('I,XY,Ia,Ja->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ce[:ncvs_so,:], t1_ce[:ncvs_so,:], optimize = einsum_type)
        temp += 0.5 * einsum('J,XY,Ia,Ja->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ce[:ncvs_so,:], t1_ce[:ncvs_so,:], optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,iXaY,ia->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_ce, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,iXax,iYax->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,iYaX,ia->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_ce, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,iYax,iXax->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,ia,iXaY->IXJY', e_core_so, np.identity(ncvs_so), t1_ce, t1_caea, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,ia,iYaX->IXJY', e_core_so, np.identity(ncvs_so), t1_ce, t1_caea, optimize = einsum_type)
        temp += einsum('a,IJ,ia,iYaX->IXJY', e_extern_so, np.identity(ncvs_so), t1_ce, t1_caea, optimize = einsum_type)
        temp += einsum('a,IJ,iXaY,ia->IXJY', e_extern_so, np.identity(ncvs_so), t1_caea, t1_ce, optimize = einsum_type)
        temp += einsum('a,IJ,iXax,iYax->IXJY', e_extern_so, np.identity(ncvs_so), t1_caea, t1_caea, optimize = einsum_type)
        temp -= einsum('a,XY,Ja,Ia->IXJY', e_extern_so, np.identity(ncas_so), t1_ce[:ncvs_so,:], t1_ce[:ncvs_so,:], optimize = einsum_type)
        temp += 0.5 * einsum('Xx,IJ,iYax,ia->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_ce, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IJ,ixaY,ia->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_ce, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IJ,ixay,iYay->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,iXax,ia->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_ce, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,ixaX,ia->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_ce, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,ixay,iXay->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, optimize = einsum_type)
        temp += einsum('xy,IJ,iXax,iYay->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, optimize = einsum_type)
        temp += einsum('Ia,JXax,Yx->IXJY', h_ce_so[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Ia,Ja,YX->IXJY', h_ce_so[:ncvs_so,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Ia,JxaY,xX->IXJY', h_ce_so[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Ja,IYax,xX->IXJY', h_ce_so[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Ja,Ia,YX->IXJY', h_ce_so[:ncvs_so,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Ja,IxaX,Yx->IXJY', h_ce_so[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('IYaX,Jyxa,yx->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IYax,Jyxa,yX->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IYax,JXya,xy->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IxaX,JyYa,yx->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Ixay,JXYa,yx->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Ixay,JXya,Yx->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Ia,JxYa,xX->IXJY', t1_ce[:ncvs_so,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Ia,JXxa,Yx->IXJY', t1_ce[:ncvs_so,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('JXaY,Ixya,yx->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('JXax,IYya,yx->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('JXax,Iyxa,Yy->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('JxaY,IyXa,xy->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('Jxay,IYXa,xy->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Jxay,IYya,xX->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Ja,IYxa,xX->IXJY', t1_ce[:ncvs_so,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Ja,IxXa,Yx->IXJY', t1_ce[:ncvs_so,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('iXax,IiJa,Yx->IXJY', t1_caea, v_ccce_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('iYax,JiIa,xX->IXJY', t1_caea, v_ccce_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('ixaX,JiIa,Yx->IXJY', t1_caea, v_ccce_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('ixaY,IiJa,xX->IXJY', t1_caea, v_ccce_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('ia,IiJa,YX->IXJY', t1_ce, v_ccce_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('ia,JiIa,YX->IXJY', t1_ce, v_ccce_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,IYaX,Jxay,xy->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,IYax,JXay,xy->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,IYax,Ja,xX->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,IYax,Jyax,yX->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,IxaX,Ja,Yx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,IxaX,JyaY,yx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,Ixay,JXaY,yx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,Ixay,JXay,Yx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,Ia,JXax,Yx->IXJY', e_core_so[:ncvs_so], t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,Ia,Ja,YX->IXJY', e_core_so[:ncvs_so], t1_ce[:ncvs_so,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,Ia,JxaY,xX->IXJY', e_core_so[:ncvs_so], t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,IYaX,Jxay,xy->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,IYax,JXay,xy->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,IYax,Ja,xX->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,IYax,Jyax,yX->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,IxaX,Ja,Yx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,IxaX,JyaY,yx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,Ixay,JXaY,yx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,Ixay,JXay,Yx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,Ia,JXax,Yx->IXJY', e_core_so[:ncvs_so], t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,Ia,Ja,YX->IXJY', e_core_so[:ncvs_so], t1_ce[:ncvs_so,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,Ia,JxaY,xX->IXJY', e_core_so[:ncvs_so], t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('a,JXaY,Ixay,yx->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('a,JXax,IYay,yx->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('a,JXax,Ia,Yx->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('a,JXax,Iyax,Yy->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('a,Ja,IYax,xX->IXJY', e_extern_so, t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('a,Ja,Ia,YX->IXJY', e_extern_so, t1_ce[:ncvs_so,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('a,Ja,IxaX,Yx->IXJY', e_extern_so, t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('a,JxaY,Ia,xX->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('a,JxaY,IyaX,xy->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('a,Jxay,IYaX,xy->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('a,Jxay,IYay,xX->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Ia,XY,Jxay,xy->IXJY', h_ce_so[:ncvs_so,:], np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Ja,XY,Ixay,yx->IXJY', h_ce_so[:ncvs_so,:], np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('ia,IJ,iYax,xX->IXJY', h_ce_so, np.identity(ncvs_so), t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('ia,IJ,ixaY,xX->IXJY', h_ce_so, np.identity(ncvs_so), t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IYax,Jyaz,yz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,Iyax,Ja,Yy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,Iyax,JzaY,zy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,JxaY,Iyaz,zy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,Jxay,IYaz,zy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,Jxay,Ia,Yy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,Jxay,Izay,Yz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IxaX,Jyaz,yz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,Ixay,JXaz,yz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,Ixay,Ja,yX->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,Ixay,Jzay,zX->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,JXax,Iyaz,zy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,Jyax,Ia,yX->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,Jyax,IzaX,yz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IYax,JXaz,yz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IYax,Ja,yX->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,IYax,Jzay,zX->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IxaX,Ja,Yy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IxaX,JzaY,zy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Ixaz,JXaY,zy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Ixaz,JXaz,Yy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Izax,JXaY,yz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('xy,Izax,JXay,Yz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,JXax,IYaz,zy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,JXax,Ia,Yy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,JxaY,Ia,yX->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,JxaY,IzaX,yz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Jxaz,IYaX,yz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jxaz,IYaz,yX->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jzax,IYaX,zy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,iXaY,ixya,yx->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,iXax,iYya,yx->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,iYaX,iyxa,yx->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,iYax,iyxa,yX->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,iYax,iXya,xy->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,ixaX,iyYa,yx->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,ixaY,iyXa,xy->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,ixay,iYXa,xy->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,ixay,iYya,xX->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('IJ,ixay,iXYa,yx->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,ia,iYxa,xX->IXJY', np.identity(ncvs_so), t1_ce, v_caae_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,ia,ixYa,xX->IXJY', np.identity(ncvs_so), t1_ce, v_caae_so, rdm_ca_so, optimize = einsum_type)
        temp += einsum('XY,Ixay,Jzya,zx->IXJY', np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('XY,Ia,Jyxa,yx->IXJY', np.identity(ncas_so), t1_ce[:ncvs_so,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('XY,Jxay,Izya,xz->IXJY', np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('XY,Ja,Ixya,yx->IXJY', np.identity(ncas_so), t1_ce[:ncvs_so,:], v_caae_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('XY,ixay,IiJa,xy->IXJY', np.identity(ncas_so), t1_caea, v_ccce_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('XY,ixay,JiIa,yx->IXJY', np.identity(ncas_so), t1_caea, v_ccce_so[:ncvs_so,:,:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('XxYy,Ixaz,Ja,zy->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('XxYy,Ixaz,Jwaz,wy->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XxYy,Izay,Ja,xz->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('XxYy,Jyaz,Ia,xz->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('XxYy,Jyaz,Iwaz,xw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XxYy,Jzax,Ia,zy->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('XxYy,Jzax,Iway,zw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,IYay,Jzaw,xw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,IYay,Ja,xz->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Iway,JzaY,xw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,JyaY,Ia,xz->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Jyaw,IYaw,xz->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Xxyz,Jwax,IYay,wz->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,IyaX,Ja,zx->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,IyaX,Jwaz,wx->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Iyaw,JXaz,wx->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Iyaw,JXaw,zx->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Yxyz,Iwax,JXay,zw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,JXay,Ia,zx->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xyzw,IYax,JXaz,wy->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,XY,Ixay,Ja,yx->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,XY,Ixay,Jzay,zx->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,XY,Ia,Jxay,xy->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,XY,Ixay,Ja,yx->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,XY,Ixay,Jzay,zx->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,XY,Ia,Jxay,xy->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,iXaY,ixay,yx->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,iXax,iYay,yx->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,iYaX,ixay,xy->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,iYax,iXay,xy->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,iYax,ia,xX->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,iYax,iyax,yX->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixaX,iyaY,yx->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixaY,ia,xX->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixaY,iyaX,xy->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,ixay,iXaY,yx->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,ixay,iYaX,xy->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixay,iYay,xX->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ia,iYax,xX->IXJY', e_core_so, np.identity(ncvs_so), t1_ce, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ia,ixaY,xX->IXJY', e_core_so, np.identity(ncvs_so), t1_ce, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('a,IJ,ia,iYax,xX->IXJY', e_extern_so, np.identity(ncvs_so), t1_ce, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += einsum('a,IJ,iXaY,ixay,yx->IXJY', e_extern_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('a,IJ,iXax,iYay,yx->IXJY', e_extern_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('a,IJ,ixaY,ia,xX->IXJY', e_extern_so, np.identity(ncvs_so), t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('a,IJ,ixaY,iyaX,xy->IXJY', e_extern_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += einsum('a,IJ,ixay,iYaX,xy->IXJY', e_extern_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('a,IJ,ixay,iYay,xX->IXJY', e_extern_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('a,XY,Ja,Ixay,yx->IXJY', e_extern_so, np.identity(ncas_so), t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('a,XY,Jxay,Ia,xy->IXJY', e_extern_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('a,XY,Jxay,Izay,xz->IXJY', e_extern_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,IJ,iYax,iyaz,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IJ,ixaY,iyaz,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,IJ,ixay,iYaz,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,IJ,iyax,izaY,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,iXax,iyaz,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,ixaX,iyaz,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,ixay,iXaz,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,ixay,ia,yX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,ixay,izay,zX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,iyax,ia,yX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,iyax,izaX,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,iXax,iYaz,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,iYax,iXaz,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,iYax,ia,yX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,IJ,iYax,izay,zX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixaX,izaY,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixaY,ia,yX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixaY,izaX,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,ixaz,iXaY,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,ixaz,iYaX,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixaz,iYaz,yX->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,izax,iXaY,yz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,izax,iYaX,zy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,XY,Ixaz,Ja,zy->IXJY', h_aa_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,XY,Ixaz,Jwaz,wy->IXJY', h_aa_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,XY,Izax,Ja,yz->IXJY', h_aa_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= einsum('xy,XY,Izax,Jway,wz->IXJY', h_aa_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,XY,Jxaz,Ia,yz->IXJY', h_aa_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,XY,Jxaz,Iwaz,yw->IXJY', h_aa_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,XY,Jzax,Ia,zy->IXJY', h_aa_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,ixaz,ia,zy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,ixaz,iwaz,wy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,iyaz,ia,xz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,iyaz,iwaz,xw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,XxYy,izax,ia,zy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,XxYy,izax,iway,zw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,XxYy,izay,ia,xz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iYay,izaw,xw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iYay,ia,xz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iyaY,ia,xz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iyaY,iwaz,xw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iyaw,iYaw,xz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,Xxyz,iwax,iYay,wz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iXay,izaw,wx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iXay,ia,zx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iyaX,ia,zx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iyaX,iwaz,wx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iyaw,iXaw,zx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,Yxyz,iwax,iXay,zw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp += einsum('IJ,xyzw,iXax,iYaz,yw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ca_so, optimize = einsum_type)
        temp -= einsum('Ia,Jxay,YxXy->IXJY', h_ce_so[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Ja,Ixay,YyXx->IXJY', h_ce_so[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IYax,Jzya,xzXy->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IxaX,Jzya,Yzxy->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Ixay,JzYa,yzXx->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Ixay,Jzya,YzXx->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Ixay,JXza,Yyxz->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Ia,Jyxa,YyXx->IXJY', t1_ce[:ncvs_so,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('JXax,Iyza,Yzxy->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('JxaY,Iyza,xzXy->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Jxay,IYza,xzXy->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('Jxay,IzXa,Yxyz->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Jxay,Izya,YxXz->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Ja,Ixya,YyXx->IXJY', t1_ce[:ncvs_so,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('ixay,IiJa,YxXy->IXJY', t1_caea, v_ccce_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('ixay,JiIa,YyXx->IXJY', t1_caea, v_ccce_so[:ncvs_so,:,:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,IYax,Jyaz,xyXz->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,IxaX,Jyaz,Yyxz->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,Ixay,JXaz,Yyxz->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,Ixay,Ja,YyXx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,Ixay,JzaY,yzXx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,Ixay,Jzay,YzXx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,Ia,Jxay,YxXy->IXJY', e_core_so[:ncvs_so], t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,IYax,Jyaz,xyXz->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,IxaX,Jyaz,Yyxz->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,Ixay,JXaz,Yyxz->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,Ixay,Ja,YyXx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,Ixay,JzaY,yzXx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,Ixay,Jzay,YzXx->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,Ia,Jxay,YxXy->IXJY', e_core_so[:ncvs_so], t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('a,JXax,Iyaz,Yzxy->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('a,Ja,Ixay,YyXx->IXJY', e_extern_so, t1_ce[:ncvs_so,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('a,JxaY,Iyaz,xzXy->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('a,Jxay,IYaz,xzXy->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('a,Jxay,Ia,YxXy->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('a,Jxay,IzaX,Yxyz->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('a,Jxay,Izay,YxXz->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xx,Iyax,Jzaw,Yzyw->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xx,Jxay,Izaw,Ywyz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,Ixay,Jzaw,yzXw->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,Jyax,Izaw,ywXz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IYax,Jzaw,yzXw->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IxaX,Jzaw,Yzyw->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Ixaz,JXaw,Yzyw->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Ixaz,Ja,YzXy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Ixaz,JwaY,zwXy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Ixaz,Jwaz,YwXy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Izax,JXaw,Yyzw->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Izax,Ja,YyXz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Izax,JwaY,ywXz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('xy,Izax,Jway,YwXz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,JXax,Izaw,Ywyz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,JxaY,Izaw,ywXz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jxaz,IYaw,ywXz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Jxaz,Ia,YyXz->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jxaz,IwaX,Yyzw->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Jxaz,Iwaz,YyXw->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Jzax,IYaw,zwXy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jzax,Ia,YzXy->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Jzax,IwaX,Yzyw->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,iYax,izya,xzXy->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,ixaY,iyza,xzXy->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,ixay,iYza,xzXy->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('IJ,ixay,izYa,yzXx->IXJY', np.identity(ncvs_so), t1_caea, v_caae_so, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('XY,Ixay,Jwza,ywxz->IXJY', np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('XY,Jxay,Izwa,xwyz->IXJY', np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XxYy,Ixaz,Jwau,zwyu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('XxYy,Izay,Jwau,xwzu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('XxYy,Jyaz,Iwau,xuzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('XxYy,Jzax,Iwau,zuyw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,IYay,Jwau,xwzu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xxyz,Ixaw,Ja,Ywyz->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xxyz,Ixaw,JuaY,wuyz->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xxyz,Ixaw,Juaw,Yuyz->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Iway,Jzau,Yxwu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Iway,Ja,Yxzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Iway,JuaY,xuzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,JyaY,Iwau,xuzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Jyaw,IYau,xuzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Jyaw,Ia,Yxzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Jyaw,Iuaw,Yxzu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xxyz,Jwax,IYau,wuyz->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xxyz,Jwax,Ia,Ywyz->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Xxyz,Jwax,Iuay,Ywzu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,IyaX,Jwau,zwxu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Iyaw,JXau,zwxu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Iyaw,Ja,zwXx->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Iyaw,Juaz,wuXx->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Iyaw,Juaw,zuXx->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yxyz,Iwax,JXau,yzwu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yxyz,Iwax,Ja,yzXw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Yxyz,Iwax,Juay,zuXw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,JXay,Iwau,zuxw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yxyz,Jxaw,Ia,yzXw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yxyz,Jxaw,IuaX,yzwu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yxyz,Jxaw,Iuaw,yzXu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Jway,Ia,zwXx->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Jway,IuaX,zwxu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,IYax,JXau,zwyu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,IYax,Jyau,zwXu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IYax,Ja,zwXy->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xyzw,IYax,Juaz,wuXy->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,IxaX,Ja,Yyzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IxaX,JuaY,yuzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,IxaX,Juay,Yuzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Ixau,JXaY,yuzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Ixau,JXay,Yuzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Ixau,JXau,Yyzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Iuax,JXaY,zwyu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('xyzw,Iuax,JXaz,Ywyu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Iuax,JyaY,zwXu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,JXax,IYau,yuzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,JXax,Ia,Yyzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,JxaY,Ia,zwXy->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,JxaY,IuaX,zwyu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Jxau,IYaX,zwyu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Jxau,IYau,zwXy->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Juax,IYaX,yuzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('I,XY,Ixay,Jzaw,yzxw->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('J,XY,Ixay,Jzaw,yzxw->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,iYax,iyaz,xyXz->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('i,IJ,ixaY,iyaz,xzXy->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixay,iYaz,xzXy->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('i,IJ,ixay,izaY,yzXx->IXJY', e_core_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('a,IJ,ixaY,iyaz,xzXy->IXJY', e_extern_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('a,IJ,ixay,iYaz,xzXy->IXJY', e_extern_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('a,XY,Jxay,Izaw,xwyz->IXJY', e_extern_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yx,IJ,ixay,izaw,yzXw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yx,IJ,iyax,izaw,ywXz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,iYax,izaw,yzXw->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,ixaY,izaw,ywXz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixaz,iYaw,ywXz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,IJ,ixaz,iwaY,zwXy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,izax,iYaw,zwXy->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,IJ,izax,iwaY,ywXz->IXJY', h_aa_so, np.identity(ncvs_so), t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,XY,Ixaz,Jwau,zwyu->IXJY', h_aa_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,XY,Izax,Jwau,ywzu->IXJY', h_aa_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,XY,Jxaz,Iwau,yuzw->IXJY', h_aa_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,XY,Jzax,Iwau,zuyw->IXJY', h_aa_so, np.identity(ncas_so), t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,XxYy,ixaz,iwau,zwyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,XxYy,iyaz,iwau,xuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,izax,iwau,zuyw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,XxYy,izay,iwau,xwzu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iYay,iwau,xwzu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Xxyz,ixaw,iuaY,wuyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iyaY,iwau,xuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Xxyz,iyaw,iYau,xuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Xxyz,iwax,iYau,wuyz->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Xxyz,iway,iuaY,xuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iXay,iwau,zuxw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,ixaw,ia,yzXw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,ixaw,iuaX,yzwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,ixaw,iuaw,yzXu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iyaX,iwau,zwxu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iyaw,iXau,zwxu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iyaw,ia,zwXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iyaw,iuaz,wuXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iyaw,iuaw,zuXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,iwax,iXau,yzwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iwax,ia,yzXw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,Yxyz,iwax,iuay,zuXw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iway,ia,zwXx->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iway,iuaX,zwxu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iXax,iYau,yuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iYax,iXau,zwyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iYax,iyau,zwXu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iYax,ia,zwXy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ccaa_so, optimize = einsum_type)
        temp -= einsum('IJ,xyzw,iYax,iuaz,wuXy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixaX,iuaY,yuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ixaY,ia,zwXy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_ce, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixaY,iuaX,zwyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ixaY,iuay,zwXu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ixau,iXaY,yuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ixau,iYaX,zwyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ixau,iYau,zwXy->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iuax,iXaY,zwyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iuax,iYaX,yuzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Ixau,Ja,yuzw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Ixau,Jvay,uvzw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Ixau,Jvau,yvzw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Iuax,Jyav,zwuv->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Iuax,Ja,zwyu->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('XY,xyzw,Iuax,Jvaz,wvyu->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Jxau,Ia,zwyu->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Jxau,Ivau,zwyv->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_ccaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Juax,Ia,yuzw->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_ccaa_so, optimize = einsum_type)
        temp += einsum('Ixay,Jwza,YywXxz->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += einsum('Jxay,Izwa,YxwXyz->IXJY', t1_caea[:ncvs_so,:,:,:], v_caae_so[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('I,Ixay,Jzaw,YyzXxw->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('J,Ixay,Jzaw,YyzXxw->IXJY', e_core_so[:ncvs_so], t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= einsum('a,Jxay,Izaw,YxwXyz->IXJY', e_extern_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Ixaz,Jwau,YzwXyu->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Izax,Jwau,YywXzu->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('xy,Jxaz,Iwau,YyuXzw->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('xy,Jzax,Iwau,YzuXyw->IXJY', h_aa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Xxyz,Ixaw,Juav,Ywuyzv->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Xxyz,Iway,Juav,Yxuzwv->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Xxyz,Jyaw,Iuav,Yxvzwu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Xxyz,Jwax,Iuav,Ywvyzu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('Yxyz,Iyaw,Juav,zwuXxv->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Yxyz,Iwax,Juav,yzuXwv->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('Yxyz,Jxaw,Iuav,yzvXwu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('Yxyz,Jway,Iuav,zwvXxu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,IYax,Juav,zwuXyv->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,IxaX,Juav,Yyuzwv->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Ixau,JXav,Yyuzwv->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Ixau,Ja,YyuXzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Ixau,JvaY,yuvXzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Ixau,Jvay,YuvXzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Ixau,Jvau,YyvXzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Iuax,JXav,Yzwyuv->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Iuax,Jyav,YzwXuv->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Iuax,Ja,YzwXyu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Iuax,JvaY,zwvXyu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= einsum('xyzw,Iuax,Jvaz,YwvXyu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,JXax,Iuav,Yyvzwu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,JxaY,Iuav,zwvXyu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Jxau,IYav,zwvXyu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Jxau,Ia,YzwXyu->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Jxau,IvaX,Yzwyuv->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('xyzw,Jxau,Ivau,YzwXyv->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Juax,IYav,yuvXzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Juax,Ia,YyuXzw->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_ce[:ncvs_so,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('xyzw,Juax,IvaX,Yyuzwv->IXJY', v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,Yxyz,ixaw,iuav,yzvXwu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.5 * einsum('IJ,Yxyz,iyaw,iuav,zwuXxv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,Yxyz,iwax,iuav,yzuXwv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.5 * einsum('IJ,Yxyz,iway,iuav,zwvXxu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,iYax,iuav,zwuXyv->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,ixaY,iuav,zwvXyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixau,iYav,zwvXyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('IJ,xyzw,ixau,ivaY,yuvXzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iuax,iYav,yuvXzw->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('IJ,xyzw,iuax,ivaY,zwvXyu->IXJY', np.identity(ncvs_so), v_aaaa_so, t1_caea, t1_caea, rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Ixau,Jvas,yuvzws->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Iuax,Jvas,zwvyus->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp += 0.25 * einsum('XY,xyzw,Jxau,Ivas,zwsyuv->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('XY,xyzw,Juax,Ivas,yuszwv->IXJY', np.identity(ncas_so), v_aaaa_so, t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], rdm_cccaaa_so, optimize = einsum_type)
        temp -= 0.25 * einsum('Ixau,Jvas,YuvXsx->IXJY', t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], m_00_int3, optimize = einsum_type)
        temp += 0.25 * einsum('Iuax,Jvas,suXvYx->IXJY', t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], m_00_int3, optimize = einsum_type)
        temp -= 0.25 * einsum('Jxau,Ivas,vuXsYx->IXJY', t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], m_00_int3, optimize = einsum_type)
        temp += 0.25 * einsum('Juax,Ivas,YusXvx->IXJY', t1_caea[:ncvs_so,:,:,:], t1_caea[:ncvs_so,:,:,:], m_00_int3, optimize = einsum_type)
