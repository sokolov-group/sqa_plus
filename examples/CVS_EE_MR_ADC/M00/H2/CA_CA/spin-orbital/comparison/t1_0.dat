        temp -= 0.5 * einsum('XY,Iiab,Jiab->IXJY', np.identity(ncas_so), t1_ccee[:ncvs_so,:,:,:], v_ccee_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= 0.5 * einsum('XY,Jiab,Iiab->IXJY', np.identity(ncas_so), t1_ccee[:ncvs_so,:,:,:], v_ccee_so[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.25 * einsum('I,XY,Iiab,Jiab->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ccee[:ncvs_so,:,:,:], t1_ccee[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.25 * einsum('J,XY,Iiab,Jiab->IXJY', e_core_so[:ncvs_so], np.identity(ncas_so), t1_ccee[:ncvs_so,:,:,:], t1_ccee[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.25 * einsum('i,XY,Iiab,Jiab->IXJY', e_core_so, np.identity(ncas_so), t1_ccee[:ncvs_so,:,:,:], t1_ccee[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.25 * einsum('i,XY,Jiab,Iiab->IXJY', e_core_so, np.identity(ncas_so), t1_ccee[:ncvs_so,:,:,:], t1_ccee[:ncvs_so,:,:,:], optimize = einsum_type)
        temp -= einsum('a,XY,Jiab,Iiab->IXJY', e_extern_so, np.identity(ncas_so), t1_ccee[:ncvs_so,:,:,:], t1_ccee[:ncvs_so,:,:,:], optimize = einsum_type)
        temp += 0.5 * einsum('Iiab,Jiab,YX->IXJY', t1_ccee[:ncvs_so,:,:,:], v_ccee_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += 0.5 * einsum('Jiab,Iiab,YX->IXJY', t1_ccee[:ncvs_so,:,:,:], v_ccee_so[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('I,Iiab,Jiab,YX->IXJY', e_core_so[:ncvs_so], t1_ccee[:ncvs_so,:,:,:], t1_ccee[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('J,Iiab,Jiab,YX->IXJY', e_core_so[:ncvs_so], t1_ccee[:ncvs_so,:,:,:], t1_ccee[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('i,Iiab,Jiab,YX->IXJY', e_core_so, t1_ccee[:ncvs_so,:,:,:], t1_ccee[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp -= 0.25 * einsum('i,Jiab,Iiab,YX->IXJY', e_core_so, t1_ccee[:ncvs_so,:,:,:], t1_ccee[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
        temp += einsum('a,Jiab,Iiab,YX->IXJY', e_extern_so, t1_ccee[:ncvs_so,:,:,:], t1_ccee[:ncvs_so,:,:,:], rdm_ca_so, optimize = einsum_type)
