K_aacc  = einsum('xyzw->ZWXY', v_aaaa_so, optimize = einsum_type).copy()
K_aacc -= einsum('xy,zw->ZWXY', h_aa_so, np.identity(ncas_so), optimize = einsum_type)
K_aacc -= einsum('xy,zw->ZWXY', h_aa_so, np.identity(ncas_so), optimize = einsum_type)
K_aacc += einsum('xy,zw->ZWXY', h_aa_so, np.identity(ncas_so), optimize = einsum_type)
K_aacc += einsum('xy,zw->ZWXY', h_aa_so, np.identity(ncas_so), optimize = einsum_type)
K_aacc -= einsum('xy,zw->ZWXY', h_aa_so, rdm_ca_so, optimize = einsum_type)
K_aacc -= einsum('xy,zw->ZWXY', h_aa_so, rdm_ca_so, optimize = einsum_type)
K_aacc += einsum('xy,zw->ZWXY', h_aa_so, rdm_ca_so, optimize = einsum_type)
K_aacc += einsum('xy,zw->ZWXY', h_aa_so, rdm_ca_so, optimize = einsum_type)
K_aacc -= einsum('xyzw,uw->ZWXY', v_aaaa_so, rdm_ca_so, optimize = einsum_type)
K_aacc += einsum('xyzw,uw->ZWXY', v_aaaa_so, rdm_ca_so, optimize = einsum_type)
K_aacc += einsum('xyzw,wu->ZWXY', v_aaaa_so, rdm_ca_so, optimize = einsum_type)
K_aacc -= einsum('xyzw,yu->ZWXY', v_aaaa_so, rdm_ca_so, optimize = einsum_type)
K_aacc -= einsum('xy,zw,yu->ZWXY', h_aa_so, np.identity(ncas_so), rdm_ca_so, optimize = einsum_type)
K_aacc -= einsum('xy,zw,yu->ZWXY', h_aa_so, np.identity(ncas_so), rdm_ca_so, optimize = einsum_type)
K_aacc += einsum('xy,zw,yu->ZWXY', h_aa_so, np.identity(ncas_so), rdm_ca_so, optimize = einsum_type)
K_aacc += einsum('xy,zw,yu->ZWXY', h_aa_so, np.identity(ncas_so), rdm_ca_so, optimize = einsum_type)
K_aacc -= einsum('xy,zwuv,vw->ZWXY', np.identity(ncas_so), v_aaaa_so, rdm_ca_so, optimize = einsum_type)
K_aacc += einsum('xy,zwuv,vw->ZWXY', np.identity(ncas_so), v_aaaa_so, rdm_ca_so, optimize = einsum_type)
K_aacc -= einsum('xy,zwuv,wv->ZWXY', np.identity(ncas_so), v_aaaa_so, rdm_ca_so, optimize = einsum_type)
K_aacc += einsum('xy,zwuv,wv->ZWXY', np.identity(ncas_so), v_aaaa_so, rdm_ca_so, optimize = einsum_type)
K_aacc -= einsum('xy,zywu->ZWXY', h_aa_so, rdm_ccaa_so, optimize = einsum_type)
K_aacc += einsum('xy,zywu->ZWXY', h_aa_so, rdm_ccaa_so, optimize = einsum_type)
K_aacc -= 1/2 * einsum('xyzw,zwuv->ZWXY', v_aaaa_so, rdm_ccaa_so, optimize = einsum_type)
K_aacc -= einsum('xyzw,uwvy->ZWXY', v_aaaa_so, rdm_ccaa_so, optimize = einsum_type)
K_aacc += einsum('xyzw,uwvy->ZWXY', v_aaaa_so, rdm_ccaa_so, optimize = einsum_type)
K_aacc -= einsum('xyzw,uyvw->ZWXY', v_aaaa_so, rdm_ccaa_so, optimize = einsum_type)
K_aacc += einsum('xyzw,uyvw->ZWXY', v_aaaa_so, rdm_ccaa_so, optimize = einsum_type)
K_aacc -= 1/2 * einsum('xy,zwuv,uvsw->ZWXY', np.identity(ncas_so), v_aaaa_so, rdm_ccaa_so, optimize = einsum_type)
K_aacc -= 1/2 * einsum('xy,zwuv,uvsw->ZWXY', np.identity(ncas_so), v_aaaa_so, rdm_ccaa_so, optimize = einsum_type)
K_aacc += 1/2 * einsum('xy,zwuv,uvsw->ZWXY', np.identity(ncas_so), v_aaaa_so, rdm_ccaa_so, optimize = einsum_type)
K_aacc += 1/2 * einsum('xy,zwuv,uvsw->ZWXY', np.identity(ncas_so), v_aaaa_so, rdm_ccaa_so, optimize = einsum_type)
K_aacc -= 1/2 * einsum('xyzw,uzwvsy->ZWXY', v_aaaa_so, rdm_cccaaa_so, optimize = einsum_type)
K_aacc += 1/2 * einsum('xyzw,uzwvsy->ZWXY', v_aaaa_so, rdm_cccaaa_so, optimize = einsum_type)
